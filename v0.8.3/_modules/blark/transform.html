

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>blark.transform &mdash; blark  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            blark
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinx.html">Sphinx API Docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/klauer/blark">GitHub Repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">blark</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">blark.transform</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for blark.transform</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">dataclasses</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">is_dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span>
                    <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lark</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnyPath</span><span class="p">,</span> <span class="n">maybe_add_brackets</span><span class="p">,</span> <span class="n">rebuild_lark_tree_with_line_map</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># NOTE: apischema is an optional requirement; this should work regardless.</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">apischema</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.apischema_compat</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_tagged_union</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">apischema</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_tagged_union</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;No-operation stand-in for when apischema is not available.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span>


<span class="n">_rule_to_class</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_class_handlers</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_comment_consumers</span> <span class="o">=</span> <span class="p">[]</span>


<div class="viewcode-block" id="FormatSettings">
<a class="viewcode-back" href="../../api/blark.transform.FormatSettings.html#blark.transform.FormatSettings">[docs]</a>
<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FormatSettings</span><span class="p">:</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;    &quot;</span></div>



<span class="n">_format_settings</span> <span class="o">=</span> <span class="n">FormatSettings</span><span class="p">()</span>


<div class="viewcode-block" id="configure_formatting">
<a class="viewcode-back" href="../../api/blark.transform.configure_formatting.html#blark.transform.configure_formatting">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">configure_formatting</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="n">FormatSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override the default code formatting settings.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_format_settings</span>
    <span class="n">_format_settings</span> <span class="o">=</span> <span class="n">settings</span></div>



<div class="viewcode-block" id="multiline_code_block">
<a class="viewcode-back" href="../../api/blark.transform.multiline_code_block.html#blark.transform.multiline_code_block">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multiline_code_block</span><span class="p">(</span><span class="n">block</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiline code block with lax beginning/end newlines.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span></div>



<div class="viewcode-block" id="join_if">
<a class="viewcode-back" href="../../api/blark.transform.join_if.html#blark.transform.join_if">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">join_if</span><span class="p">(</span><span class="n">value1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&#39;{value1}{delimiter}{value2} if value1 and value2, otherwise just {value1} or {value2}.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="indent_if">
<a class="viewcode-back" href="../../api/blark.transform.indent_if.html#blark.transform.indent_if">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">indent_if</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stringified and indented {value} if not None.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">_format_settings</span><span class="o">.</span><span class="n">indent</span>
        <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="indent">
<a class="viewcode-back" href="../../api/blark.transform.indent.html#blark.transform.indent">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">indent</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stringified and indented {value}.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">_format_settings</span><span class="o">.</span><span class="n">indent</span>
    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">prefix</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_commented</span><span class="p">(</span><span class="n">meta</span><span class="p">:</span> <span class="n">Meta</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;comments&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">comments</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}{</span><span class="n">item</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">block</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="o">*</span><span class="n">comments</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_add_comments_to_return_value</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_commented</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s2">&quot;_comment_wrapped&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span>  <span class="c1"># pragma: no cover</span>

    <span class="n">wrapped</span><span class="o">.</span><span class="n">_comment_wrapped</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">wrapped</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_default_instantiator</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">instantiator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">instantiator</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_rule_handler</span><span class="p">(</span>
    <span class="o">*</span><span class="n">rules</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">comments</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator - the wrapped class will handle the provided rules.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;from_lark&quot;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">from_lark</span> <span class="o">=</span> <span class="n">_get_default_instantiator</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">_rule_to_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Handler already specified for: </span><span class="si">{</span><span class="n">rule</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">handler</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>  <span class="c1"># pragma: no cover</span>

            <span class="n">_rule_to_class</span><span class="p">[</span><span class="n">rule</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
            <span class="n">_class_handlers</span><span class="p">[</span><span class="n">rule</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_lark</span>

        <span class="k">if</span> <span class="n">comments</span><span class="p">:</span>
            <span class="c1"># Mark ``cls`` as one that consumes comments when stringifying code.</span>
            <span class="n">_comment_consumers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="fm">__str__</span> <span class="o">=</span> <span class="n">_add_comments_to_return_value</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="fm">__str__</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<div class="viewcode-block" id="Meta">
<a class="viewcode-back" href="../../api/blark.transform.Meta.html#blark.transform.Meta">[docs]</a>
<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lark-derived meta information in the form of a dataclass.&quot;&quot;&quot;</span>
    <span class="c1">#: If the metadata information is not yet filled.</span>
    <span class="n">empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">#: Column number.</span>
    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Comments relating to the line.</span>
    <span class="n">comments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: Containing start column.</span>
    <span class="n">container_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Containing end column.</span>
    <span class="n">container_end_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Containing end line.</span>
    <span class="n">container_end_line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Containing start line.</span>
    <span class="n">container_line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Final column number.</span>
    <span class="n">end_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Final line number.</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Final character position.</span>
    <span class="n">end_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Line number.</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Starting character position.</span>
    <span class="n">start_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Meta.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Meta.html#blark.transform.Meta.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">Meta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a Meta instance from the lark Metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Meta</span><span class="p">(</span>
            <span class="n">empty</span><span class="o">=</span><span class="n">lark_meta</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span>
            <span class="n">column</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;column&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">comments</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;comments&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="n">container_column</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;container_column&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">container_end_column</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;container_end_column&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">container_end_line</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;container_end_line&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">container_line</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;container_line&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">end_column</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;end_column&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">end_line</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;end_line&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">end_pos</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;end_pos&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">start_pos</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lark_meta</span><span class="p">,</span> <span class="s2">&quot;start_pos&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Meta.get_comments_and_pragmas">
<a class="viewcode-back" href="../../api/blark.transform.Meta.html#blark.transform.Meta.get_comments_and_pragmas">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_comments_and_pragmas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split the contained comments into comments/pragmas.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        comments : List[lark.Token]</span>
<span class="sd">        pragmas : List[lark.Token]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">pragmas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">comments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">by_type</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;SINGLE_LINE_COMMENT&quot;</span><span class="p">:</span> <span class="n">comments</span><span class="p">,</span>
            <span class="s2">&quot;MULTI_LINE_COMMENT&quot;</span><span class="p">:</span> <span class="n">comments</span><span class="p">,</span>
            <span class="s2">&quot;PRAGMA&quot;</span><span class="p">:</span> <span class="n">pragmas</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
            <span class="n">by_type</span><span class="p">[</span><span class="n">comment</span><span class="o">.</span><span class="n">type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">comments</span><span class="p">,</span> <span class="n">pragmas</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">attribute_pragmas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get {attribute ...} pragmas associated with this code block.&quot;&quot;&quot;</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">pragmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_comments_and_pragmas</span><span class="p">()</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pragma</span> <span class="ow">in</span> <span class="n">pragmas</span><span class="p">:</span>
            <span class="c1"># TODO: better pragma parsing; it&#39;s its own grammar</span>
            <span class="k">if</span> <span class="n">pragma</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{attribute &quot;</span><span class="p">):</span>  <span class="c1"># }</span>
                <span class="n">attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pragma</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; }&#39;&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">attributes</span></div>



<div class="viewcode-block" id="meta_field">
<a class="viewcode-back" href="../../api/blark.transform.meta_field.html#blark.transform.meta_field">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">meta_field</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the Meta field for the dataclass magic.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_grammar_for_class">
<a class="viewcode-back" href="../../api/blark.transform.get_grammar_for_class.html#blark.transform.get_grammar_for_class">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_grammar_for_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a class, get blark&#39;s ``iec.lark`` associated grammar definition(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">rule</span><span class="p">,</span> <span class="n">othercls</span> <span class="ow">in</span> <span class="n">_rule_to_class</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">othercls</span> <span class="ow">is</span> <span class="bp">cls</span><span class="p">:</span>
            <span class="n">matches</span><span class="p">[</span><span class="n">rule</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
        <span class="n">matches</span><span class="p">[</span><span class="n">rule</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_grammar_for_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matches</span></div>



<div class="viewcode-block" id="_FlagHelper">
<a class="viewcode-back" href="../../api/blark.transform._FlagHelper.html#blark.transform._FlagHelper">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">_FlagHelper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A helper base class which translates tokens to ``enum.Flag`` instances.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="_FlagHelper.from_lark">
<a class="viewcode-back" href="../../api/blark.transform._FlagHelper.html#blark.transform._FlagHelper.from_lark">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="o">*</span><span class="n">tokens</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">|=</span> <span class="bp">cls</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">option</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="TypeInformation">
<a class="viewcode-back" href="../../api/blark.transform.TypeInformation.html#blark.transform.TypeInformation">[docs]</a>
<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TypeInformation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Type information derived from a specification or initialization.&quot;&quot;&quot;</span>

    <span class="n">base_type_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">full_type_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">Any</span>

<div class="viewcode-block" id="TypeInformation.from_init">
<a class="viewcode-back" href="../../api/blark.transform.TypeInformation.html#blark.transform.TypeInformation.from_init">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_init</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span>
        <span class="n">init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">StructureInitialization</span><span class="p">,</span>
            <span class="n">ArrayTypeInitialization</span><span class="p">,</span>
            <span class="n">StringTypeInitialization</span><span class="p">,</span>
            <span class="n">TypeInitialization</span><span class="p">,</span>
            <span class="n">SubrangeTypeInitialization</span><span class="p">,</span>
            <span class="n">EnumeratedTypeInitialization</span><span class="p">,</span>
            <span class="n">InitializedStructure</span><span class="p">,</span>
            <span class="n">FunctionCall</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">StructureInitialization</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">UnresolvedTypeInformation</span><span class="p">(</span>  <span class="c1"># TODO</span>
                <span class="n">base_type_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">full_type_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">InitializedStructure</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">base_type_name</span><span class="o">=</span><span class="n">init</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">full_type_name</span><span class="o">=</span><span class="n">init</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">):</span>
            <span class="c1"># May be multi-element variable referenve; stringified here.</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">base_type_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">full_type_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">context</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">spec_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_spec</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">TypeInitialization</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">base_type_name</span><span class="o">=</span><span class="n">spec_type</span><span class="o">.</span><span class="n">base_type_name</span><span class="p">,</span>
                <span class="n">full_type_name</span><span class="o">=</span><span class="n">spec_type</span><span class="o">.</span><span class="n">full_type_name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">spec_type</span></div>


<div class="viewcode-block" id="TypeInformation.from_spec">
<a class="viewcode-back" href="../../api/blark.transform.TypeInformation.html#blark.transform.TypeInformation.from_spec">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_spec</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span>
        <span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">ArraySpecification</span><span class="p">,</span>
            <span class="n">DataType</span><span class="p">,</span>
            <span class="n">EnumeratedSpecification</span><span class="p">,</span>
            <span class="n">FunctionCall</span><span class="p">,</span>
            <span class="n">IndirectSimpleSpecification</span><span class="p">,</span>
            <span class="n">ObjectInitializerArray</span><span class="p">,</span>
            <span class="n">SimpleSpecification</span><span class="p">,</span>
            <span class="n">StringTypeSpecification</span><span class="p">,</span>
            <span class="n">SubrangeSpecification</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="n">full_type_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">DataType</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">type_name</span><span class="p">,</span> <span class="n">StringTypeSpecification</span><span class="p">):</span>
                <span class="n">base_type_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_type_name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">type_name</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">ArraySpecification</span><span class="p">):</span>
            <span class="n">base_type_name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">base_type_name</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">StringTypeSpecification</span><span class="p">):</span>
            <span class="n">base_type_name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">base_type_name</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">EnumeratedSpecification</span><span class="p">):</span>
            <span class="n">base_type_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">type_name</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">_implicit_type_default_</span><span class="p">)</span>
            <span class="n">full_type_name</span> <span class="o">=</span> <span class="n">base_type_name</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="n">SimpleSpecification</span><span class="p">,</span> <span class="n">IndirectSimpleSpecification</span><span class="p">)):</span>
            <span class="n">base_type_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">SubrangeSpecification</span><span class="p">):</span>
            <span class="n">base_type_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">):</span>
            <span class="n">base_type_name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">base_type_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># base_type_name = str(spec.name)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">base_type_name</span><span class="o">=</span><span class="n">base_type_name</span><span class="p">,</span>
            <span class="n">full_type_name</span><span class="o">=</span><span class="n">full_type_name</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="UnresolvedTypeInformation">
<a class="viewcode-back" href="../../api/blark.transform.UnresolvedTypeInformation.html#blark.transform.UnresolvedTypeInformation">[docs]</a>
<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnresolvedTypeInformation</span><span class="p">(</span><span class="n">TypeInformation</span><span class="p">):</span>
    <span class="o">...</span></div>



<div class="viewcode-block" id="VariableAttributes">
<a class="viewcode-back" href="../../api/blark.transform.VariableAttributes.html#blark.transform.VariableAttributes">[docs]</a>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;variable_attributes&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VariableAttributes</span><span class="p">(</span><span class="n">_FlagHelper</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="n">constant</span> <span class="o">=</span> <span class="mb">0b0000_0001</span>
    <span class="n">retain</span> <span class="o">=</span> <span class="mb">0b0000_0010</span>
    <span class="n">non_retain</span> <span class="o">=</span> <span class="mb">0b0000_0100</span>
    <span class="n">persistent</span> <span class="o">=</span> <span class="mb">0b0000_1000</span></div>



<div class="viewcode-block" id="GlobalVariableAttributes">
<a class="viewcode-back" href="../../api/blark.transform.GlobalVariableAttributes.html#blark.transform.GlobalVariableAttributes">[docs]</a>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;global_variable_attributes&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GlobalVariableAttributes</span><span class="p">(</span><span class="n">_FlagHelper</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="n">constant</span> <span class="o">=</span> <span class="mb">0b0000_0001</span>
    <span class="n">retain</span> <span class="o">=</span> <span class="mb">0b0000_0010</span>
    <span class="n">non_retain</span> <span class="o">=</span> <span class="mb">0b0000_0100</span>
    <span class="n">persistent</span> <span class="o">=</span> <span class="mb">0b0000_1000</span>
    <span class="n">internal</span> <span class="o">=</span> <span class="mb">0b0001_0000</span></div>



<div class="viewcode-block" id="AccessSpecifier">
<a class="viewcode-back" href="../../api/blark.transform.AccessSpecifier.html#blark.transform.AccessSpecifier">[docs]</a>
<span class="nd">@_rule_handler</span><span class="p">(</span>
    <span class="s2">&quot;access_specifier&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AccessSpecifier</span><span class="p">(</span><span class="n">_FlagHelper</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="n">public</span> <span class="o">=</span> <span class="mb">0b0000_0001</span>
    <span class="n">private</span> <span class="o">=</span> <span class="mb">0b0000_0010</span>
    <span class="n">abstract</span> <span class="o">=</span> <span class="mb">0b0000_0100</span>
    <span class="n">protected</span> <span class="o">=</span> <span class="mb">0b0000_1000</span>
    <span class="n">internal</span> <span class="o">=</span> <span class="mb">0b0001_0000</span>
    <span class="n">final</span> <span class="o">=</span> <span class="mb">0b010_0000</span></div>



<div class="viewcode-block" id="Expression">
<a class="viewcode-back" href="../../api/blark.transform.Expression.html#blark.transform.Expression">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Expression</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all types of expressions.</span>

<span class="sd">    This includes all literals (integers, etc.) and more complicated</span>
<span class="sd">    mathematical expressions.</span>

<span class="sd">    Marked as a &quot;tagged union&quot; so that serialization will uniquely identify the</span>
<span class="sd">    Python class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>



<div class="viewcode-block" id="Literal">
<a class="viewcode-back" href="../../api/blark.transform.Literal.html#blark.transform.Literal">[docs]</a>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Literal</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all literal values.</span>

<span class="sd">    Marked as a &quot;tagged union&quot; so that serialization will uniquely identify the</span>
<span class="sd">    Python class.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Integer">
<a class="viewcode-back" href="../../api/blark.transform.Integer.html#blark.transform.Integer">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;integer_literal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Integer</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer literal value.&quot;&quot;&quot;</span>

    <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Integer.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Integer.html#blark.transform.Integer.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Integer</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">base</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
            <span class="c1"># Adding type_name information; wrap Integer</span>
            <span class="n">value</span><span class="o">.</span><span class="n">type_name</span> <span class="o">=</span> <span class="n">type_name</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">_base_to_integer_class</span><span class="p">[</span><span class="n">base</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="mi">10</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">value</span></div>



<div class="viewcode-block" id="BinaryInteger">
<a class="viewcode-back" href="../../api/blark.transform.BinaryInteger.html#blark.transform.BinaryInteger">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;binary_integer&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BinaryInteger</span><span class="p">(</span><span class="n">Integer</span><span class="p">):</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span></div>



<div class="viewcode-block" id="OctalInteger">
<a class="viewcode-back" href="../../api/blark.transform.OctalInteger.html#blark.transform.OctalInteger">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;octal_integer&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OctalInteger</span><span class="p">(</span><span class="n">Integer</span><span class="p">):</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span></div>



<div class="viewcode-block" id="HexInteger">
<a class="viewcode-back" href="../../api/blark.transform.HexInteger.html#blark.transform.HexInteger">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;hex_integer&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HexInteger</span><span class="p">(</span><span class="n">Integer</span><span class="p">):</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span></div>



<span class="n">_base_to_integer_class</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Integer</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">2</span><span class="p">:</span> <span class="n">BinaryInteger</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="n">OctalInteger</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="n">Integer</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="n">HexInteger</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="Real">
<a class="viewcode-back" href="../../api/blark.transform.Real.html#blark.transform.Real">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;real_literal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Real</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Floating point (real) literal value.&quot;&quot;&quot;</span>

    <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Real.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Real.html#blark.transform.Real.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Real</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Real</span><span class="p">(</span><span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="BitString">
<a class="viewcode-back" href="../../api/blark.transform.BitString.html#blark.transform.BitString">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;bit_string_literal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BitString</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bit string literal value.&quot;&quot;&quot;</span>

    <span class="c1">#: The optional type name of the string.</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="c1">#: The string literal.</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="c1">#: The numeric base of the value (e.g., 10 is decimal)</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1">#: Lark metadata.</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="BitString.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.BitString.html#blark.transform.BitString.from_lark">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="mi">10</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">value</span></div>



<div class="viewcode-block" id="BinaryBitString">
<a class="viewcode-back" href="../../api/blark.transform.BinaryBitString.html#blark.transform.BinaryBitString">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;binary_bit_string_literal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BinaryBitString</span><span class="p">(</span><span class="n">BitString</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Binary bit string literal value.&quot;&quot;&quot;</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span></div>



<div class="viewcode-block" id="OctalBitString">
<a class="viewcode-back" href="../../api/blark.transform.OctalBitString.html#blark.transform.OctalBitString">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;octal_bit_string_literal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OctalBitString</span><span class="p">(</span><span class="n">BitString</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Octal bit string literal value.&quot;&quot;&quot;</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span></div>



<div class="viewcode-block" id="HexBitString">
<a class="viewcode-back" href="../../api/blark.transform.HexBitString.html#blark.transform.HexBitString">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;hex_bit_string_literal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HexBitString</span><span class="p">(</span><span class="n">BitString</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hex bit string literal value.&quot;&quot;&quot;</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span></div>



<div class="viewcode-block" id="Boolean">
<a class="viewcode-back" href="../../api/blark.transform.Boolean.html#blark.transform.Boolean">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Boolean</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean literal value.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;TRUE&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;FALSE&quot;</span></div>



<div class="viewcode-block" id="Duration">
<a class="viewcode-back" href="../../api/blark.transform.Duration.html#blark.transform.Duration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Duration</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Duration literal value.&quot;&quot;&quot;</span>

    <span class="n">days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hours</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">minutes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">milliseconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">negative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Duration.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Duration.html#blark.transform.Duration.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">minus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">interval</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Duration</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
            <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
            <span class="p">{</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">interval</span><span class="o">.</span><span class="n">iter_subtrees</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Duration</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="n">minus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The duration value.&quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hours</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milliseconds</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;TIME#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="Lduration">
<a class="viewcode-back" href="../../api/blark.transform.Lduration.html#blark.transform.Lduration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;lduration&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Lduration</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Long duration literal value.&quot;&quot;&quot;</span>

    <span class="n">days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hours</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">minutes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">milliseconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">microseconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nanoseconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">negative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Lduration.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Lduration.html#blark.transform.Lduration.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">minus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">interval</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lduration</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
            <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
            <span class="p">{</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">interval</span><span class="o">.</span><span class="n">iter_subtrees</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Lduration</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="n">minus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The long duration value.&quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hours</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milliseconds</span><span class="p">,</span> <span class="s2">&quot;MS&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">microseconds</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nanoseconds</span><span class="p">,</span> <span class="s2">&quot;NS&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;LTIME#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="TimeOfDay">
<a class="viewcode-back" href="../../api/blark.transform.TimeOfDay.html#blark.transform.TimeOfDay">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;time_of_day&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeOfDay</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time of day literal value.&quot;&quot;&quot;</span>
    <span class="n">hour</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">minute</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">second</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The time of day value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hour</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">minute</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;TIME_OF_DAY#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="LtimeOfDay">
<a class="viewcode-back" href="../../api/blark.transform.LtimeOfDay.html#blark.transform.LtimeOfDay">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;ltime_of_day&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LtimeOfDay</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Long time of day literal value.&quot;&quot;&quot;</span>
    <span class="n">hour</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">minute</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">second</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The long time of day value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hour</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">minute</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;LTIME_OF_DAY#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="Date">
<a class="viewcode-back" href="../../api/blark.transform.Date.html#blark.transform.Date">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Date</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Date literal value.&quot;&quot;&quot;</span>

    <span class="n">year</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">month</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">day</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The time of day value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DATE#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="Ldate">
<a class="viewcode-back" href="../../api/blark.transform.Ldate.html#blark.transform.Ldate">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;ldate&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Ldate</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Long date literal value.&quot;&quot;&quot;</span>

    <span class="n">year</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">month</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">day</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The long time of day value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;LDATE#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="DateTime">
<a class="viewcode-back" href="../../api/blark.transform.DateTime.html#blark.transform.DateTime">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;date_and_time&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DateTime</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Date and time literal value.&quot;&quot;&quot;</span>

    <span class="n">date</span><span class="p">:</span> <span class="n">Date</span>
    <span class="n">time</span><span class="p">:</span> <span class="n">TimeOfDay</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="DateTime.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.DateTime.html#blark.transform.DateTime.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">year</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">month</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">day</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">hour</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">minute</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">second</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DateTime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DateTime</span><span class="p">(</span>
            <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">),</span>
            <span class="n">time</span><span class="o">=</span><span class="n">TimeOfDay</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="n">second</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The time of day value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DT#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="LdateTime">
<a class="viewcode-back" href="../../api/blark.transform.LdateTime.html#blark.transform.LdateTime">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;ldate_and_time&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LdateTime</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Long date and time literal value.&quot;&quot;&quot;</span>

    <span class="n">ldate</span><span class="p">:</span> <span class="n">Ldate</span>
    <span class="n">ltime</span><span class="p">:</span> <span class="n">LtimeOfDay</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="LdateTime.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.LdateTime.html#blark.transform.LdateTime.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">year</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">month</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">day</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">hour</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">minute</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">second</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LdateTime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">LdateTime</span><span class="p">(</span>
            <span class="n">ldate</span><span class="o">=</span><span class="n">Ldate</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">),</span>
            <span class="n">ltime</span><span class="o">=</span><span class="n">LtimeOfDay</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="n">second</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The time of day value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ldate</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ltime</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;LDT#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="String">
<a class="viewcode-back" href="../../api/blark.transform.String.html#blark.transform.String">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;string_literal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">String</span><span class="p">(</span><span class="n">Literal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;String literal value.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="Variable">
<a class="viewcode-back" href="../../api/blark.transform.Variable.html#blark.transform.Variable">[docs]</a>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Variable</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variable base class.</span>

<span class="sd">    Marked as a &quot;tagged union&quot; so that serialization will uniquely identify the</span>
<span class="sd">    Python class.</span>

<span class="sd">    Includes:</span>

<span class="sd">    1. Direct variables with I/O linkage (e.g., ``var AT %I*``); may be</span>
<span class="sd">       located (e.g., ``AT %IX1.1``) or incomplete (e.g., just ``%I*``).</span>
<span class="sd">    2. &quot;Simple&quot;, single-element variables (referenced by name, potentially</span>
<span class="sd">        dereferenced pointers) (e.g., ``var`` or ``var^``).</span>
<span class="sd">    3. Multi-element variables (e.g., ``a.b.c`` or ``a^.b[1].c``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span></div>



<div class="viewcode-block" id="IndirectionType">
<a class="viewcode-back" href="../../api/blark.transform.IndirectionType.html#blark.transform.IndirectionType">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span>
    <span class="s2">&quot;indirection_type&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pointer_type&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IndirectionType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Indirect access through a pointer or reference.&quot;&quot;&quot;</span>
    <span class="c1">#: A depth of 1 is &quot;POINTER TO&quot;, a depth of 2 is &quot;POINTER TO POINTER TO&quot;.</span>
    <span class="n">pointer_depth</span><span class="p">:</span> <span class="nb">int</span>
    <span class="c1">#: If set, &quot;REFERENCE TO POINTER TO...&quot;</span>
    <span class="n">reference</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_indirect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this denotes a pointer (of any depth) or a reference.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="IndirectionType.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.IndirectionType.html#blark.transform.IndirectionType.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">tokens</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectionType</span><span class="p">:</span>
        <span class="n">pointer_depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">upper_tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">tokens</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pointer_depth</span> <span class="o">=</span> <span class="n">upper_tokens</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;POINTER TO&quot;</span><span class="p">)</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="s2">&quot;REFERENCE TO&quot;</span> <span class="ow">in</span> <span class="n">upper_tokens</span>
        <span class="k">return</span> <span class="n">IndirectionType</span><span class="p">(</span>
            <span class="n">pointer_depth</span><span class="o">=</span><span class="n">pointer_depth</span><span class="p">,</span>
            <span class="n">reference</span><span class="o">=</span><span class="n">reference</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;REFERENCE TO&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span>
            <span class="p">[</span><span class="s2">&quot;POINTER TO&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointer_depth</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>



<div class="viewcode-block" id="IncompleteLocation">
<a class="viewcode-back" href="../../api/blark.transform.IncompleteLocation.html#blark.transform.IncompleteLocation">[docs]</a>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;incomplete_location&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IncompleteLocation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Incomplete location information.&quot;&quot;&quot;</span>
    <span class="n">none</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="c1">#: I/O to PLC task.</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;%I*&quot;</span>
    <span class="c1">#: PLC task to I/O.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;%Q*&quot;</span>
    <span class="c1">#: Memory.</span>
    <span class="n">memory</span> <span class="o">=</span> <span class="s2">&quot;%M*&quot;</span>

<div class="viewcode-block" id="IncompleteLocation.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.IncompleteLocation.html#blark.transform.IncompleteLocation.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">IncompleteLocation</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IncompleteLocation</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">IncompleteLocation</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AT </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="VariableLocationPrefix">
<a class="viewcode-back" href="../../api/blark.transform.VariableLocationPrefix.html#blark.transform.VariableLocationPrefix">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VariableLocationPrefix</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="c1">#: I/O to PLC task.</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
    <span class="c1">#: PLC task to I/O.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;Q&quot;</span>
    <span class="n">memory</span> <span class="o">=</span> <span class="s2">&quot;M&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>



<div class="viewcode-block" id="VariableSizePrefix">
<a class="viewcode-back" href="../../api/blark.transform.VariableSizePrefix.html#blark.transform.VariableSizePrefix">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VariableSizePrefix</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Size prefix, used in locations (e.g., ``%IX1.1`` has a bit prefix).&quot;&quot;&quot;</span>
    <span class="n">bit</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
    <span class="n">byte</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span>
    <span class="n">word_16</span> <span class="o">=</span> <span class="s2">&quot;W&quot;</span>
    <span class="n">dword_32</span> <span class="o">=</span> <span class="s2">&quot;D&quot;</span>
    <span class="n">lword_64</span> <span class="o">=</span> <span class="s2">&quot;L&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>



<div class="viewcode-block" id="DirectVariable">
<a class="viewcode-back" href="../../api/blark.transform.DirectVariable.html#blark.transform.DirectVariable">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;direct_variable&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DirectVariable</span><span class="p">(</span><span class="n">Variable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Direct variables with I/O linkage.</span>

<span class="sd">    Example: ``var AT %I*``</span>

<span class="sd">    May be located (e.g., ``AT %IX1.1``) or incomplete (e.g., just ``%I*``).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: The location prefix (e.g., I, Q, or M)</span>
    <span class="n">location_prefix</span><span class="p">:</span> <span class="n">VariableLocationPrefix</span>
    <span class="c1">#: The location number itself (e.g., 2 of %IX2.1)</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="c1">#: Size prefix, used in locations (e.g., ``%IX1.1`` has a bit prefix).</span>
    <span class="n">size_prefix</span><span class="p">:</span> <span class="n">VariableSizePrefix</span>
    <span class="c1">#: The number of bits.</span>
    <span class="n">bits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Lark metadata.</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="DirectVariable.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.DirectVariable.html#blark.transform.DirectVariable.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">location_prefix</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">size_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
        <span class="n">location</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="o">*</span><span class="n">bits</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">DirectVariable</span><span class="p">(</span>
            <span class="n">location_prefix</span><span class="o">=</span><span class="n">VariableLocationPrefix</span><span class="p">(</span><span class="n">location_prefix</span><span class="p">),</span>
            <span class="n">size_prefix</span><span class="o">=</span><span class="p">(</span>
                <span class="n">VariableSizePrefix</span><span class="p">(</span><span class="n">size_prefix</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">size_prefix</span> <span class="k">else</span> <span class="n">VariableSizePrefix</span><span class="o">.</span><span class="n">bit</span>
            <span class="p">),</span>
            <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
            <span class="n">bits</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="k">if</span> <span class="n">bits</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bits</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">location_prefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">size_prefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="si">}{</span><span class="n">bits</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="Location">
<a class="viewcode-back" href="../../api/blark.transform.Location.html#blark.transform.Location">[docs]</a>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Location</span><span class="p">(</span><span class="n">DirectVariable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A located direct variable. (e.g., ``AT %IX1.1``)&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Location.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Location.html#blark.transform.Location.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">DirectVariable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Location</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Location</span><span class="p">(</span>
            <span class="n">location_prefix</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">location_prefix</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
            <span class="n">size_prefix</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">size_prefix</span><span class="p">,</span>
            <span class="n">bits</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">bits</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">direct_loc</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AT </span><span class="si">{</span><span class="n">direct_loc</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="SimpleVariable">
<a class="viewcode-back" href="../../api/blark.transform.SimpleVariable.html#blark.transform.SimpleVariable">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;variable_name&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimpleVariable</span><span class="p">(</span><span class="n">Variable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple, single-element variable.</span>

<span class="sd">    Specified by name, may potentially be dereferenced pointers.</span>
<span class="sd">    Examples::</span>

<span class="sd">        var</span>
<span class="sd">        var^</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">dereferenced</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="SimpleVariable.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.SimpleVariable.html#blark.transform.SimpleVariable.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">identifier</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">dereferenced</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimpleVariable</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SimpleVariable</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
            <span class="n">dereferenced</span><span class="o">=</span><span class="n">dereferenced</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">^&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dereferenced</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="SubscriptList">
<a class="viewcode-back" href="../../api/blark.transform.SubscriptList.html#blark.transform.SubscriptList">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;subscript_list&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SubscriptList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list of subscripts.</span>

<span class="sd">    Examples::</span>

<span class="sd">        [1, 2, 3]</span>
<span class="sd">        [Constant, GVL.Value, 1 + 3]</span>
<span class="sd">        [1]^</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subscripts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span>
    <span class="n">dereferenced</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="SubscriptList.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.SubscriptList.html#blark.transform.SubscriptList.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="o">*</span><span class="n">subscripts</span><span class="p">,</span> <span class="n">dereferenced</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">SubscriptList</span><span class="p">(</span>
            <span class="n">subscripts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subscripts</span><span class="p">),</span>
            <span class="n">dereferenced</span><span class="o">=</span><span class="n">dereferenced</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subscript</span><span class="p">)</span> <span class="k">for</span> <span class="n">subscript</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscripts</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">parts</span><span class="si">}</span><span class="s2">]^&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dereferenced</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">parts</span><span class="si">}</span><span class="s2">]&quot;</span></div>



<div class="viewcode-block" id="FieldSelector">
<a class="viewcode-back" href="../../api/blark.transform.FieldSelector.html#blark.transform.FieldSelector">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;field_selector&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FieldSelector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Field - or attribute - selector as part of a multi-element variable.</span>

<span class="sd">    Examples::</span>

<span class="sd">        .field</span>
<span class="sd">        .field^</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">SimpleVariable</span>
    <span class="n">dereferenced</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="FieldSelector.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.FieldSelector.html#blark.transform.FieldSelector.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">dereferenced</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">field</span><span class="p">:</span> <span class="n">SimpleVariable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FieldSelector</span><span class="p">(</span>
            <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
            <span class="n">dereferenced</span><span class="o">=</span><span class="n">dereferenced</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;^.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dereferenced</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="MultiElementVariable">
<a class="viewcode-back" href="../../api/blark.transform.MultiElementVariable.html#blark.transform.MultiElementVariable">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;multi_element_variable&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiElementVariable</span><span class="p">(</span><span class="n">Variable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A multi-element variable - with one or more subscripts and fields.</span>

<span class="sd">    Examples::</span>

<span class="sd">        a.b.c</span>
<span class="sd">        a^.b[1].c</span>
<span class="sd">        a.b[SomeConstant].c^</span>

<span class="sd">    Where ``a`` is the &quot;name&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The first part of the variable name.</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">SimpleVariable</span>
    <span class="c1">#: This is unused (TODO / perhaps for compat elsewhere?)</span>
    <span class="c1">#: Dereference status is held on a per-element basis.</span>
    <span class="n">dereferenced</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="c1">#: The subscripts/fields that make up the multi-element variable.</span>
    <span class="n">elements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">SubscriptList</span><span class="p">,</span> <span class="n">FieldSelector</span><span class="p">]]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="MultiElementVariable.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.MultiElementVariable.html#blark.transform.MultiElementVariable.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">variable_name</span><span class="p">:</span> <span class="n">SimpleVariable</span><span class="p">,</span>
        <span class="o">*</span><span class="n">subscript_or_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SubscriptList</span><span class="p">,</span> <span class="n">FieldSelector</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiElementVariable</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MultiElementVariable</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span>
            <span class="n">elements</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subscript_or_field</span><span class="p">),</span>
            <span class="n">dereferenced</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span></div>



<span class="n">SymbolicVariable</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">SimpleVariable</span><span class="p">,</span> <span class="n">MultiElementVariable</span><span class="p">]</span>


<div class="viewcode-block" id="TypeInitializationBase">
<a class="viewcode-back" href="../../api/blark.transform.TypeInitializationBase.html#blark.transform.TypeInitializationBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TypeInitializationBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for type initializations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">type_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeInformation</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TypeInformation</span><span class="o">.</span><span class="n">from_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_info</span><span class="o">.</span><span class="n">base_type_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full, qualified type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_info</span><span class="o">.</span><span class="n">full_type_name</span></div>



<div class="viewcode-block" id="TypeSpecificationBase">
<a class="viewcode-back" href="../../api/blark.transform.TypeSpecificationBase.html#blark.transform.TypeSpecificationBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TypeSpecificationBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for a specification of a type.</span>

<span class="sd">    Can specify a:</span>

<span class="sd">    1. Enumeration::</span>

<span class="sd">        ( 1, 1 ) INT</span>
<span class="sd">        TYPE_NAME     (TODO; ambiguous with 2)</span>

<span class="sd">    2. A simple or string type specification::</span>

<span class="sd">        TYPE_NAME</span>
<span class="sd">        STRING</span>
<span class="sd">        STRING[255]</span>

<span class="sd">    3. An indirect simple specification::</span>

<span class="sd">        POINTER TO TYPE_NAME</span>
<span class="sd">        REFERENCE TO TYPE_NAME</span>
<span class="sd">        REFERENCE TO POINTER TO TYPE_NAME</span>

<span class="sd">    4. An array specification::</span>

<span class="sd">        ARRAY [1..2] OF TypeName</span>
<span class="sd">        ARRAY [1..2] OF TypeName(1, 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">type_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeInformation</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TypeInformation</span><span class="o">.</span><span class="n">from_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_info</span><span class="o">.</span><span class="n">base_type_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_info</span><span class="o">.</span><span class="n">full_type_name</span></div>



<div class="viewcode-block" id="TypeInitialization">
<a class="viewcode-back" href="../../api/blark.transform.TypeInitialization.html#blark.transform.TypeInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;simple_spec_init&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TypeInitialization</span><span class="p">(</span><span class="n">TypeInitializationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple initialization specification of a type name.</span>

<span class="sd">    Example::</span>

<span class="sd">        TypeName := Value1</span>
<span class="sd">        STRING[100] := &quot;value&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SimpleSpecification</span><span class="p">,</span> <span class="n">IndirectSimpleSpecification</span><span class="p">]</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_type_name</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="SimpleTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.SimpleTypeDeclaration.html#blark.transform.SimpleTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;simple_type_declaration&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimpleTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A declaration of a simple type.</span>

<span class="sd">    Examples::</span>

<span class="sd">        TypeName : INT</span>
<span class="sd">        TypeName : INT := 5</span>
<span class="sd">        TypeName : INT := 5 + 1 * (2)</span>
<span class="sd">        TypeName : REFERENCE TO INT</span>
<span class="sd">        TypeName : POINTER TO INT</span>
<span class="sd">        TypeName : POINTER TO POINTER TO INT</span>
<span class="sd">        TypeName : REFERENCE TO POINTER TO INT</span>
<span class="sd">        TypeName EXTENDS a.b : POINTER TO INT</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">TypeInitialization</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="StringTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.StringTypeDeclaration.html#blark.transform.StringTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;string_type_declaration&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StringTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A string type declaration.</span>

<span class="sd">    Examples::</span>
<span class="sd">        TypeName : STRING</span>
<span class="sd">        TypeName : STRING := &#39;literal&#39;</span>
<span class="sd">        TypeName : STRING[5]</span>
<span class="sd">        TypeName : STRING[100] := &#39;literal&#39;</span>
<span class="sd">        TypeName : WSTRING[100] := &quot;literal&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">string_type</span><span class="p">:</span> <span class="n">StringTypeSpecification</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">String</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_type</span><span class="o">.</span><span class="n">type_name</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">type_and_value</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string_type</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">type_and_value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="StringTypeSpecification">
<a class="viewcode-back" href="../../api/blark.transform.StringTypeSpecification.html#blark.transform.StringTypeSpecification">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;string_type_specification&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StringTypeSpecification</span><span class="p">(</span><span class="n">TypeSpecificationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specification of a string type.</span>

<span class="sd">    Examples::</span>

<span class="sd">        STRING(2_500_000)</span>
<span class="sd">        STRING(Param.iLower)</span>
<span class="sd">        STRING(Param.iLower * 2 + 10)</span>
<span class="sd">        STRING(Param.iLower / 2 + 10)</span>

<span class="sd">    Bracketed versions are also acceptable::</span>

<span class="sd">        STRING[2_500_000]</span>
<span class="sd">        STRING[Param.iLower]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StringSpecLength</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_type_name</span></div>



<div class="viewcode-block" id="StringTypeInitialization">
<a class="viewcode-back" href="../../api/blark.transform.StringTypeInitialization.html#blark.transform.StringTypeInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span>
    <span class="s2">&quot;single_byte_string_spec&quot;</span><span class="p">,</span>
    <span class="s2">&quot;double_byte_string_spec&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StringTypeInitialization</span><span class="p">(</span><span class="n">TypeInitializationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Single or double-byte string specification.</span>

<span class="sd">    Examples::</span>

<span class="sd">        STRING := &#39;test&#39;</span>
<span class="sd">        STRING(2_500_000) := &#39;test&#39;</span>
<span class="sd">        STRING(Param.iLower) := &#39;test&#39;</span>

<span class="sd">    Bracketed versions are also acceptable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">StringTypeSpecification</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="StringTypeInitialization.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.StringTypeInitialization.html#blark.transform.StringTypeInitialization.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">string_type</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StringSpecLength</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringTypeInitialization</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">StringTypeSpecification</span><span class="p">(</span><span class="n">string_type</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">StringTypeInitialization</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="Subrange">
<a class="viewcode-back" href="../../api/blark.transform.Subrange.html#blark.transform.Subrange">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Subrange</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subrange base class.</span>

<span class="sd">    May be a full or partial sub-range. Marked as a &quot;tagged union&quot; so that</span>
<span class="sd">    serialization will uniquely identify the Python class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span></div>



<div class="viewcode-block" id="FullSubrange">
<a class="viewcode-back" href="../../api/blark.transform.FullSubrange.html#blark.transform.FullSubrange">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FullSubrange</span><span class="p">(</span><span class="n">Subrange</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full subrange (i.e., asterisk ``*``).</span>

<span class="sd">    Example::</span>

<span class="sd">        Array[*]</span>
<span class="sd">              ^</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;*&quot;</span></div>



<div class="viewcode-block" id="PartialSubrange">
<a class="viewcode-back" href="../../api/blark.transform.PartialSubrange.html#blark.transform.PartialSubrange">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;subrange&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PartialSubrange</span><span class="p">(</span><span class="n">Subrange</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A partial subrange, including a start/stop element index.</span>

<span class="sd">    Examples::</span>

<span class="sd">        1..2</span>
<span class="sd">        iStart..iEnd</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">stop</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">..</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="SubrangeSpecification">
<a class="viewcode-back" href="../../api/blark.transform.SubrangeSpecification.html#blark.transform.SubrangeSpecification">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;subrange_specification&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SubrangeSpecification</span><span class="p">(</span><span class="n">TypeSpecificationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subrange specification.</span>

<span class="sd">    Examples::</span>

<span class="sd">        INT (*)</span>
<span class="sd">        INT (1..2)</span>
<span class="sd">        TYPE_NAME         (TODO; overlap)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">subrange</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Subrange</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subrange</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subrange</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_type_name</span></div>



<div class="viewcode-block" id="SubrangeTypeInitialization">
<a class="viewcode-back" href="../../api/blark.transform.SubrangeTypeInitialization.html#blark.transform.SubrangeTypeInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;subrange_spec_init&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SubrangeTypeInitialization</span><span class="p">(</span><span class="n">TypeInitializationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subrange type initialization.</span>

<span class="sd">    Examples::</span>

<span class="sd">        INT (1..2) := 25</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: coverage + examples?</span>
    <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">]</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">SubrangeSpecification</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spec</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2"> := </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="SubrangeTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.SubrangeTypeDeclaration.html#blark.transform.SubrangeTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;subrange_type_declaration&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SubrangeTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subrange type declaration.</span>

<span class="sd">    Examples::</span>

<span class="sd">        TypeName : INT (1..2)</span>
<span class="sd">        TypeName : INT (*) := 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">SubrangeTypeInitialization</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="EnumeratedValue">
<a class="viewcode-back" href="../../api/blark.transform.EnumeratedValue.html#blark.transform.EnumeratedValue">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;enumerated_value&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnumeratedValue</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An enumerated value.</span>

<span class="sd">    Examples::</span>

<span class="sd">        IdentifierB</span>
<span class="sd">        IdentifierB := 1</span>
<span class="sd">        INT#IdentifierB</span>
<span class="sd">        INT#IdentifierB := 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: coverage?</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Integer</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="EnumeratedSpecification">
<a class="viewcode-back" href="../../api/blark.transform.EnumeratedSpecification.html#blark.transform.EnumeratedSpecification">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;enumerated_specification&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnumeratedSpecification</span><span class="p">(</span><span class="n">TypeSpecificationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An enumerated specification.</span>

<span class="sd">    Examples::</span>

<span class="sd">        (Value1, Value2 := 1)</span>
<span class="sd">        (Value1, Value2 := 1) INT</span>
<span class="sd">        INT</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_implicit_type_default_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;INT&quot;</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EnumeratedValue</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="EnumeratedSpecification.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.EnumeratedSpecification.html#blark.transform.EnumeratedSpecification.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">type_name</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span>
            <span class="k">return</span> <span class="n">EnumeratedSpecification</span><span class="p">(</span><span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">)</span>
        <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="n">type_name</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">EnumeratedSpecification</span><span class="p">(</span><span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="EnumeratedTypeInitialization">
<a class="viewcode-back" href="../../api/blark.transform.EnumeratedTypeInitialization.html#blark.transform.EnumeratedTypeInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;enumerated_spec_init&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnumeratedTypeInitialization</span><span class="p">(</span><span class="n">TypeInitializationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumerated specification with initialization enumerated value.</span>

<span class="sd">    May be indirect (i.e., POINTER TO).</span>

<span class="sd">    Examples::</span>

<span class="sd">        (Value1, Value2 := 1) := IdentifierB</span>
<span class="sd">        (Value1, Value2 := 1) INT := IdentifierC</span>
<span class="sd">        INT := IdentifierD</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO coverage + double-check examples (doctest-like?)</span>
    <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">]</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">EnumeratedSpecification</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnumeratedValue</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="EnumeratedTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.EnumeratedTypeDeclaration.html#blark.transform.EnumeratedTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;enumerated_type_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnumeratedTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An enumerated type declaration.</span>

<span class="sd">    Examples::</span>

<span class="sd">        TypeName : TypeName := Va</span>
<span class="sd">        TypeName : (Value1 := 1, Value2 := 2)</span>
<span class="sd">        TypeName : (Value1 := 1, Value2 := 2) INT := Value1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">EnumeratedTypeInitialization</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="DataType">
<a class="viewcode-back" href="../../api/blark.transform.DataType.html#blark.transform.DataType">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;non_generic_type_name&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DataType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A non-generic type name, or a data type name.</span>

<span class="sd">    May be indirect (e.g., POINTER TO).</span>

<span class="sd">    An elementary type name, a derived type name, or a general dotted</span>
<span class="sd">    identifier are valid for this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: more grammar overlaps with dotted/simple names?</span>
    <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">]</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">StringTypeSpecification</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="o">.</span><span class="n">is_indirect</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="SimpleSpecification">
<a class="viewcode-back" href="../../api/blark.transform.SimpleSpecification.html#blark.transform.SimpleSpecification">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;simple_specification&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimpleSpecification</span><span class="p">(</span><span class="n">TypeSpecificationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple specification with just a type name (or a string type name).</span>

<span class="sd">    An elementary type name, a simple type name, or a general dotted</span>
<span class="sd">    identifier are valid for this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">StringTypeSpecification</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span></div>



<div class="viewcode-block" id="IndirectSimpleSpecification">
<a class="viewcode-back" href="../../api/blark.transform.IndirectSimpleSpecification.html#blark.transform.IndirectSimpleSpecification">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;indirect_simple_specification&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IndirectSimpleSpecification</span><span class="p">(</span><span class="n">TypeSpecificationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple specification with the possibility of indirection.</span>

<span class="sd">    Examples::</span>

<span class="sd">        TypeName</span>
<span class="sd">        POINTER TO TypeName</span>
<span class="sd">        REFERENCE TO TypeName</span>
<span class="sd">        REFERENCE TO POINTER TO TypeName</span>

<span class="sd">    Initialization parameters such as these are parsed but otherwise ignored</span>
<span class="sd">    by TwinCAT::</span>

<span class="sd">        POINTER TO TypeName(1, 2)</span>
<span class="sd">        POINTER TO TypeName(1, 2, C := 4)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">]</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">SimpleSpecification</span>
    <span class="n">init_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">InputParameterAssignment</span><span class="p">]]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="IndirectSimpleSpecification.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.IndirectSimpleSpecification.html#blark.transform.IndirectSimpleSpecification.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">],</span>
        <span class="n">type_</span><span class="p">:</span> <span class="n">SimpleSpecification</span><span class="p">,</span>
        <span class="n">init_parameters_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndirectSimpleSpecification</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">init_parameters_tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">init_parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">init_parameters</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="n">List</span><span class="p">[</span><span class="n">InputParameterAssignment</span><span class="p">],</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">init_parameters_tree</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">IndirectSimpleSpecification</span><span class="p">(</span>
            <span class="n">indirection</span><span class="p">,</span>
            <span class="n">type_</span><span class="p">,</span>
            <span class="n">init_parameters</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">full_type</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">full_type</span>

        <span class="n">initializers</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">init</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_parameters</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">full_type</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">initializers</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<span class="c1"># _array_spec_type</span>
<span class="n">ArraySpecType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">DataType</span><span class="p">,</span>
    <span class="s2">&quot;FunctionCall&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ObjectInitializerArray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ArraySpecification&quot;</span><span class="p">,</span>
    <span class="n">StringTypeSpecification</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="ArraySpecification">
<a class="viewcode-back" href="../../api/blark.transform.ArraySpecification.html#blark.transform.ArraySpecification">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;array_specification&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ArraySpecification</span><span class="p">(</span><span class="n">TypeSpecificationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An array specification.</span>

<span class="sd">    Examples::</span>

<span class="sd">        ARRAY[*] OF TypeName</span>
<span class="sd">        ARRAY[1..2] OF Call(1, 2)</span>
<span class="sd">        ARRAY[1..2] OF Call(1, 2)</span>
<span class="sd">        ARRAY[1..5] OF Vec(SIZEOF(TestStruct), 0)</span>
<span class="sd">        ARRAY[1..5] OF STRING[10]</span>
<span class="sd">        ARRAY[1..5] OF STRING(Param.iLower)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subranges</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Subrange</span><span class="p">]</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">ArraySpecType</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">DataType</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">type_name</span><span class="p">,</span> <span class="n">StringTypeSpecification</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">type_name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">ArraySpecification</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">base_type_name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">StringTypeSpecification</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">base_type_name</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="ArraySpecification.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.ArraySpecification.html#blark.transform.ArraySpecification.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="o">*</span><span class="n">subranges</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
            <span class="c1"># STRING_TYPE</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">DataType</span><span class="p">(</span>
                <span class="n">indirection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">type_name</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ArraySpecification</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">subranges</span><span class="o">=</span><span class="n">subranges</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">subranges</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subrange</span><span class="p">)</span> <span class="k">for</span> <span class="n">subrange</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subranges</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ARRAY [</span><span class="si">{</span><span class="n">subranges</span><span class="si">}</span><span class="s2">] OF </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="ArrayInitialElement">
<a class="viewcode-back" href="../../api/blark.transform.ArrayInitialElement.html#blark.transform.ArrayInitialElement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;array_initial_element&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ArrayInitialElement</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initial value for an array element (potentialy repeated).</span>

<span class="sd">    The element itself may be an expression, a structure initialization, an</span>
<span class="sd">    enumerated value, or an array initialization.</span>

<span class="sd">    It may have a repeat value (``count``) as in::</span>

<span class="sd">        Repeat(Value)</span>
<span class="sd">        10(5)</span>
<span class="sd">        Repeat(5 + 3)</span>
<span class="sd">        INT#IdentifierB(5 + 3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: order is correct here; see rule array_initial_element_count</span>
    <span class="c1"># TODO: check enumerated value for count? specifically the := one</span>
    <span class="n">element</span><span class="p">:</span> <span class="n">ArrayInitialElementType</span>
    <span class="n">count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">EnumeratedValue</span><span class="p">,</span> <span class="n">Integer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="_ArrayInitialElementCount">
<a class="viewcode-back" href="../../api/blark.transform._ArrayInitialElementCount.html#blark.transform._ArrayInitialElementCount">[docs]</a>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;array_initial_element_count&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_ArrayInitialElementCount</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An internal handler for array initial elements with repeat count</span>
<span class="sd">    values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="_ArrayInitialElementCount.from_lark">
<a class="viewcode-back" href="../../api/blark.transform._ArrayInitialElementCount.html#blark.transform._ArrayInitialElementCount.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">count</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EnumeratedValue</span><span class="p">,</span> <span class="n">Integer</span><span class="p">],</span>
        <span class="n">element</span><span class="p">:</span> <span class="n">ArrayInitialElementType</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayInitialElement</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ArrayInitialElement</span><span class="p">(</span>
            <span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="_BracketedArrayInitialization">
<a class="viewcode-back" href="../../api/blark.transform._BracketedArrayInitialization.html#blark.transform._BracketedArrayInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;bracketed_array_initialization&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_BracketedArrayInitialization</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal handler for array initialization with brackets.</span>

<span class="sd">    See also :class:`ArrayInitialization`</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="_BracketedArrayInitialization.from_lark">
<a class="viewcode-back" href="../../api/blark.transform._BracketedArrayInitialization.html#blark.transform._BracketedArrayInitialization.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">elements</span><span class="p">:</span> <span class="n">ArrayInitialElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayInitialization</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ArrayInitialization</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">brackets</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="_BareArrayInitialization">
<a class="viewcode-back" href="../../api/blark.transform._BareArrayInitialization.html#blark.transform._BareArrayInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;bare_array_initialization&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_BareArrayInitialization</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal handler for array initialization, without brackets</span>

<span class="sd">    See also :class:`ArrayInitialization`</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="_BareArrayInitialization.from_lark">
<a class="viewcode-back" href="../../api/blark.transform._BareArrayInitialization.html#blark.transform._BareArrayInitialization.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">elements</span><span class="p">:</span> <span class="n">ArrayInitialElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayInitialization</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ArrayInitialization</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">brackets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ArrayInitialization">
<a class="viewcode-back" href="../../api/blark.transform.ArrayInitialization.html#blark.transform.ArrayInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ArrayInitialization</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Array initialization (bare or bracketed).</span>

<span class="sd">    Examples::</span>

<span class="sd">        [1, 2, 3]</span>
<span class="sd">        1, 2, 3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ArrayInitialElement</span><span class="p">]</span>
    <span class="n">brackets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">brackets</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">elements</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">return</span> <span class="n">elements</span></div>



<div class="viewcode-block" id="ObjectInitializerArray">
<a class="viewcode-back" href="../../api/blark.transform.ObjectInitializerArray.html#blark.transform.ObjectInitializerArray">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;object_initializer_array&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ObjectInitializerArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object initialization in array form.</span>

<span class="sd">    Examples::</span>

<span class="sd">      FB_Runner[(name := &#39;one&#39;), (name := &#39;two&#39;)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">initializers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">StructureInitialization</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="ObjectInitializerArray.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.ObjectInitializerArray.html#blark.transform.ObjectInitializerArray.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">function_block_type_name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="o">*</span><span class="n">initializers</span><span class="p">:</span> <span class="n">StructureInitialization</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ObjectInitializerArray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ObjectInitializerArray</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">function_block_type_name</span><span class="p">,</span>
            <span class="n">initializers</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">initializers</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">initializers</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">maybe_add_brackets</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">init</span><span class="p">),</span> <span class="s2">&quot;()&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">init</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializers</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">initializers</span><span class="si">}</span><span class="s2">]&quot;</span></div>



<div class="viewcode-block" id="ArrayTypeInitialization">
<a class="viewcode-back" href="../../api/blark.transform.ArrayTypeInitialization.html#blark.transform.ArrayTypeInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;array_spec_init&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ArrayTypeInitialization</span><span class="p">(</span><span class="n">TypeInitializationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Array specification and optional default (initialization) value.</span>

<span class="sd">    May be indirect (e.g., POINTER TO).</span>

<span class="sd">    Examples::</span>

<span class="sd">        ARRAY[*] OF TypeName</span>
<span class="sd">        ARRAY[1..2] OF Call(1, 2) := [1, 2]</span>
<span class="sd">        POINTER TO ARRAY[1..2] OF Call(1, 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">]</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">ArraySpecification</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayInitialization</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spec</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2"> := </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="ArrayTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.ArrayTypeDeclaration.html#blark.transform.ArrayTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;array_type_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ArrayTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Full declaration of an array type.</span>

<span class="sd">    Examples::</span>

<span class="sd">        ArrayType : ARRAY[*] OF TypeName</span>
<span class="sd">        ArrayType : ARRAY[1..2] OF Call(1, 2) := [1, 2]</span>
<span class="sd">        ArrayType : POINTER TO ARRAY[1..2] OF Call(1, 2)</span>
<span class="sd">        TypeName : ARRAY [1..2, 3..4] OF INT</span>
<span class="sd">        TypeName : ARRAY [1..2] OF INT := [1, 2]</span>
<span class="sd">        TypeName : ARRAY [1..2, 3..4] OF INT := [2(3), 3(4)]</span>
<span class="sd">        TypeName : ARRAY [1..2, 3..4] OF Tc.SomeType</span>
<span class="sd">        TypeName : ARRAY [1..2, 3..4] OF Tc.SomeType(someInput := 3)</span>
<span class="sd">        TypeName : ARRAY [1..2, 3..4] OF ARRAY [1..2] OF INT</span>
<span class="sd">        TypeName : ARRAY [1..2, 3..4] OF ARRAY [1..2] OF ARRAY [3..4] OF INT</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">ArrayTypeInitialization</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="StructureTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.StructureTypeDeclaration.html#blark.transform.StructureTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;structure_type_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StructureTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Full structure type declaration, as part of a TYPE.</span>

<span class="sd">    Examples::</span>

<span class="sd">        TypeName EXTENDS Other.Type :</span>
<span class="sd">        STRUCT</span>
<span class="sd">            iValue : INT;</span>
<span class="sd">        END_STRUCT</span>

<span class="sd">        TypeName : POINTER TO</span>
<span class="sd">        STRUCT</span>
<span class="sd">            iValue : INT;</span>
<span class="sd">        END_STRUCT</span>

<span class="sd">        TypeName : POINTER TO</span>
<span class="sd">        STRUCT</span>
<span class="sd">            iValue : INT := 3 + 4;</span>
<span class="sd">            stTest : ST_Testing := (1, 2);</span>
<span class="sd">            eValue : E_Test := E_Test.ABC;</span>
<span class="sd">            arrValue : ARRAY [1..2] OF INT := [1, 2];</span>
<span class="sd">            arrValue1 : INT (1..2);</span>
<span class="sd">            arrValue1 : (Value1 := 1) INT;</span>
<span class="sd">            sValue : STRING := &#39;abc&#39;;</span>
<span class="sd">            iValue1 AT %I* : INT := 5;</span>
<span class="sd">            sValue1 : STRING[10] := &#39;test&#39;;</span>
<span class="sd">        END_STRUCT</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">]</span>
    <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">]</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">StructureElementDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="StructureTypeDeclaration.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.StructureTypeDeclaration.html#blark.transform.StructureTypeDeclaration.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">],</span>
        <span class="n">indirection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndirectionType</span><span class="p">],</span>
        <span class="o">*</span><span class="n">declarations</span><span class="p">:</span> <span class="n">StructureElementDeclaration</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">StructureTypeDeclaration</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">indirection</span><span class="o">=</span><span class="n">indirection</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">declarations</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;STRUCT&quot;</span><span class="p">,</span>
                    <span class="n">indent</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">decl</span><span class="si">}</span><span class="s2">;&quot;</span> <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">)),</span>
                    <span class="s2">&quot;END_STRUCT&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s2">&quot;STRUCT&quot;</span><span class="p">,</span> <span class="s2">&quot;END_STRUCT&quot;</span><span class="p">))</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">)</span>
        <span class="n">indirection</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indirection</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indirection</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">definition</span><span class="si">}</span><span class="s2"> :</span><span class="si">{</span><span class="n">indirection</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="StructureElementDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.StructureElementDeclaration.html#blark.transform.StructureElementDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;structure_element_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StructureElementDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declaration line of a structure, typically with a single variable name.</span>

<span class="sd">    Excludes the trailing semicolon.</span>

<span class="sd">    Examples::</span>

<span class="sd">        iValue : INT := 3 + 4</span>
<span class="sd">        stTest : ST_Testing := (1, 2)</span>
<span class="sd">        eValue : E_Test := E_Test.ABC</span>
<span class="sd">        arrValue : ARRAY [1..2] OF INT := [1, 2]</span>
<span class="sd">        arrValue1 : INT (1..2)</span>
<span class="sd">        arrValue1 : (Value1 := 1) INT</span>
<span class="sd">        sValue : STRING := &#39;abc&#39;</span>
<span class="sd">        iValue1 AT %I* : INT := 5</span>
<span class="sd">        sValue1 : STRING[10] := &#39;test&#39;</span>
<span class="sd">        Timer1, Timer2, Timer3 : library.TPUDO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">ArrayTypeInitialization</span><span class="p">,</span>
        <span class="n">StringTypeInitialization</span><span class="p">,</span>
        <span class="n">TypeInitialization</span><span class="p">,</span>
        <span class="n">SubrangeTypeInitialization</span><span class="p">,</span>
        <span class="n">EnumeratedTypeInitialization</span><span class="p">,</span>
        <span class="n">InitializedStructure</span><span class="p">,</span>
        <span class="n">FunctionCall</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The initialization value, if applicable.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">base_type_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">full_type_name</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variables</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="n">UnionElementSpecification</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">ArraySpecification</span><span class="p">,</span>
    <span class="n">SimpleSpecification</span><span class="p">,</span>
    <span class="n">SubrangeSpecification</span><span class="p">,</span>
    <span class="n">EnumeratedSpecification</span><span class="p">,</span>
    <span class="n">IndirectSimpleSpecification</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="UnionElementDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.UnionElementDeclaration.html#blark.transform.UnionElementDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;union_element_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnionElementDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declaration of a single element of a union.</span>

<span class="sd">    Similar to a structure element, but not all types are supported and no</span>
<span class="sd">    initialization/default values are allowed.</span>

<span class="sd">    Examples::</span>

<span class="sd">        iValue : INT;</span>
<span class="sd">        arrValue : ARRAY [1..2] OF INT;</span>
<span class="sd">        arrValue1 : INT (1..2);</span>
<span class="sd">        arrValue1 : (Value1 := 1) INT;</span>
<span class="sd">        sValue : STRING;</span>
<span class="sd">        psValue1 : POINTER TO STRING[10];</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">UnionElementSpecification</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;API compat&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="UnionTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.UnionTypeDeclaration.html#blark.transform.UnionTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;union_type_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnionTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full declaration of a UNION type, as part of a TYPE/END_TYPE block.</span>

<span class="sd">    Examples::</span>

<span class="sd">        UNION</span>
<span class="sd">            iVal : INT;</span>
<span class="sd">            aAsBytes : ARRAY [0..2] OF BYTE;</span>
<span class="sd">        END_UNION</span>

<span class="sd">        UNION</span>
<span class="sd">            iValue : INT;</span>
<span class="sd">            eValue : (iValue := 1, iValue2 := 2) INT;</span>
<span class="sd">        END_UNION</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">]</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UnionElementDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="UnionTypeDeclaration.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.UnionTypeDeclaration.html#blark.transform.UnionTypeDeclaration.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">],</span>
        <span class="o">*</span><span class="n">decls</span><span class="p">:</span> <span class="n">UnionElementDeclaration</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">UnionTypeDeclaration</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">decls</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">decls</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decls</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span> <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">definition</span><span class="si">}</span><span class="s2"> :&quot;</span><span class="p">,</span>
                <span class="s2">&quot;UNION&quot;</span><span class="p">,</span>
                <span class="n">decls</span><span class="p">,</span>
                <span class="s2">&quot;END_UNION&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="InitializedStructure">
<a class="viewcode-back" href="../../api/blark.transform.InitializedStructure.html#blark.transform.InitializedStructure">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;initialized_structure&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InitializedStructure</span><span class="p">(</span><span class="n">TypeInitializationBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A named initialized structure.</span>

<span class="sd">    Examples::</span>

<span class="sd">        ST_TypeName := (iValue := 0, bValue := TRUE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">StructureInitialization</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The initialization value (call).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> := </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="StructureInitialization">
<a class="viewcode-back" href="../../api/blark.transform.StructureInitialization.html#blark.transform.StructureInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;structure_initialization&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StructureInitialization</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A structure initialization (i.e., default values) of one or more elements.</span>

<span class="sd">    Elements may be either positional or named.  Used in the following:</span>

<span class="sd">    1. Structure element initialization of default values::</span>

<span class="sd">        stStruct : ST_TypeName := (iValue := 0, bValue := TRUE)</span>
<span class="sd">                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">    2. Function block declarations (fb_name_decl, fb_invocation_decl)::</span>

<span class="sd">        fbSample : FB_Sample(nInitParam := 1) := (nInput := 2, nMyProperty := 3)</span>
<span class="sd">                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="sd">        fbSample : FB_Sample := (nInput := 2, nMyProperty := 3)</span>
<span class="sd">                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">    3. Array object initializers (object_initializer_array)::</span>

<span class="sd">        runners : ARRAY[1..2] OF FB_Runner[(name := &#39;one&#39;), (name := &#39;two&#39;)]</span>
<span class="sd">                                          [^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">StructureElementInitialization</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="StructureInitialization.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.StructureInitialization.html#blark.transform.StructureInitialization.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">elements</span><span class="p">:</span> <span class="n">StructureElementInitialization</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">StructureInitialization</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">parts</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="StructureElementInitialization">
<a class="viewcode-back" href="../../api/blark.transform.StructureElementInitialization.html#blark.transform.StructureElementInitialization">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;structure_element_initialization&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StructureElementInitialization</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An initialization (default) value for a structure element.</span>

<span class="sd">    This may come in the form of::</span>

<span class="sd">        name := value</span>

<span class="sd">    or simply::</span>

<span class="sd">        value</span>

<span class="sd">    ``value`` may refer to an expression, an enumerated value, represent</span>
<span class="sd">    a whole array, or represent a nested structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Constant</span><span class="p">,</span>
        <span class="n">Expression</span><span class="p">,</span>
        <span class="n">EnumeratedValue</span><span class="p">,</span>
        <span class="n">ArrayInitialization</span><span class="p">,</span>
        <span class="n">StructureInitialization</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="StructureElementInitialization.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.StructureElementInitialization.html#blark.transform.StructureElementInitialization.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">value</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">StructureElementInitialization</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> := </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="UnaryOperation">
<a class="viewcode-back" href="../../api/blark.transform.UnaryOperation.html#blark.transform.UnaryOperation">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;unary_expression&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnaryOperation</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A unary - single operand - operation: ``NOT``, ``-``, or ``+``.&quot;&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="UnaryOperation.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.UnaryOperation.html#blark.transform.UnaryOperation.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">operator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expr</span>
        <span class="k">return</span> <span class="n">UnaryOperation</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">operator</span><span class="p">,</span>
            <span class="n">expr</span><span class="o">=</span><span class="n">expr</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="s2">&quot;-+&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="BinaryOperation">
<a class="viewcode-back" href="../../api/blark.transform.BinaryOperation.html#blark.transform.BinaryOperation">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span>
    <span class="s2">&quot;expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;add_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;and_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;and_then_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;or_else_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;assignment_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;xor_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;comparison_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;equality_expression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expression_term&quot;</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BinaryOperation</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A binary (i.e., two operand) operation.</span>

<span class="sd">    Examples::</span>

<span class="sd">        a + b</span>
<span class="sd">        a AND b</span>
<span class="sd">        a AND_THEN b</span>
<span class="sd">        a OR_ELSE b</span>
<span class="sd">        a := b</span>
<span class="sd">        a XOR b</span>
<span class="sd">        a = b</span>
<span class="sd">        -a * b</span>
<span class="sd">        a * 1.0</span>

<span class="sd">    Expressions may be nested in either the left or right operand.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">right</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="BinaryOperation.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.BinaryOperation.html#blark.transform.BinaryOperation.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="o">*</span><span class="n">operator_and_expr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">Expression</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">operator_and_expr</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">left</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_operator_and_expr</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">Expression</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">operators</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Tuple</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">operator_and_expr</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">expressions</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Expression</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">operator_and_expr</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">yield from</span> <span class="nb">zip</span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="n">expressions</span><span class="p">)</span>

        <span class="n">binop</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">operator</span><span class="p">,</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">get_operator_and_expr</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">binop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">binop</span> <span class="o">=</span> <span class="n">BinaryOperation</span><span class="p">(</span>
                    <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                    <span class="n">op</span><span class="o">=</span><span class="n">operator</span><span class="p">,</span>
                    <span class="n">right</span><span class="o">=</span><span class="n">expression</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binop</span> <span class="o">=</span> <span class="n">BinaryOperation</span><span class="p">(</span>
                    <span class="n">left</span><span class="o">=</span><span class="n">binop</span><span class="p">,</span>
                    <span class="n">op</span><span class="o">=</span><span class="n">operator</span><span class="p">,</span>
                    <span class="n">right</span><span class="o">=</span><span class="n">expression</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">binop</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="ParenthesizedExpression">
<a class="viewcode-back" href="../../api/blark.transform.ParenthesizedExpression.html#blark.transform.ParenthesizedExpression">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;parenthesized_expression&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ParenthesizedExpression</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An expression with parentheses around it.</span>

<span class="sd">    Examples::</span>

<span class="sd">        (a * b)</span>
<span class="sd">        (1 + b)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="BracketedExpression">
<a class="viewcode-back" href="../../api/blark.transform.BracketedExpression.html#blark.transform.BracketedExpression">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;bracketed_expression&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BracketedExpression</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An expression with square brackets around it.</span>

<span class="sd">    This is used exclusively in string length specifications.</span>

<span class="sd">    Examples::</span>

<span class="sd">        [a * b]</span>
<span class="sd">        [255]</span>

<span class="sd">    See also :class:`StringSpecLength`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">]&quot;</span></div>



<div class="viewcode-block" id="StringSpecLength">
<a class="viewcode-back" href="../../api/blark.transform.StringSpecLength.html#blark.transform.StringSpecLength">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;string_spec_length&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StringSpecLength</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The length of a defined string.</span>

<span class="sd">    The grammar makes a distinction between brackets and parentheses, though</span>
<span class="sd">    they appear to be functionally equivalent.</span>

<span class="sd">    Examples::</span>

<span class="sd">        [1]</span>
<span class="sd">        (1)</span>
<span class="sd">        [255]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">length</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParenthesizedExpression</span><span class="p">,</span> <span class="n">BracketedExpression</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span></div>



<div class="viewcode-block" id="FunctionCall">
<a class="viewcode-back" href="../../api/blark.transform.FunctionCall.html#blark.transform.FunctionCall">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;function_call&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionCall</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function (function block, method, action, etc.) call.</span>

<span class="sd">    The return value may be dereferenced with a carat (``^``).</span>

<span class="sd">    Examples::</span>

<span class="sd">        A()^</span>
<span class="sd">        A(1, 2)</span>
<span class="sd">        A(1, 2, sName:=&#39;test&#39;, iOutput=&gt;)</span>
<span class="sd">        A.B[1].C(1, 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The function name.</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">SymbolicVariable</span>
    <span class="c1">#: Positional, naed, or output parameters.</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ParameterAssignment</span><span class="p">]</span>
    <span class="c1">#: Dereference the return value?</span>
    <span class="n">dereferenced</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The base type name.</span>

<span class="sd">        This is used as part of the summary mechanism. The &quot;type&quot; is that</span>
<span class="sd">        of the underlying function block or function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">SimpleVariable</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name, including any dereferencing or subscripts.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The initialization value (the function call itself).</span>

<span class="sd">        This is used as part of the summary tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="FunctionCall.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.FunctionCall.html#blark.transform.FunctionCall.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">SymbolicVariable</span><span class="p">,</span>
        <span class="o">*</span><span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterAssignment</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionCall</span><span class="p">:</span>
        <span class="c1"># Condition parameters (which may be `None`) to represent empty tuple</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">dereferenced</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">params</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;^&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dereferenced</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">FunctionCall</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">ParameterAssignment</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">)),</span>
            <span class="n">dereferenced</span><span class="o">=</span><span class="n">dereferenced</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dereference</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dereferenced</span><span class="p">:</span>
            <span class="n">dereference</span> <span class="o">=</span> <span class="s2">&quot;^&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">parameters</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">dereference</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="ChainedFunctionCall">
<a class="viewcode-back" href="../../api/blark.transform.ChainedFunctionCall.html#blark.transform.ChainedFunctionCall">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;chained_function_call&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChainedFunctionCall</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A set of chained function (function block, method, action, etc.) calls.</span>

<span class="sd">    The return value may be dereferenced with a carat (``^``).</span>

<span class="sd">    Examples::</span>

<span class="sd">        A()^.B()</span>
<span class="sd">        A(1, 2).B().C()</span>
<span class="sd">        A(1, 2, sName:=&#39;test&#39;, iOutput=&gt;).C().D()</span>
<span class="sd">        A.B[1].C(1, 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">invocations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionCall</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="ChainedFunctionCall.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.ChainedFunctionCall.html#blark.transform.ChainedFunctionCall.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">invocations</span><span class="p">:</span> <span class="n">FunctionCall</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChainedFunctionCall</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ChainedFunctionCall</span><span class="p">(</span>
            <span class="n">invocations</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">invocations</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">invocation</span><span class="p">)</span> <span class="k">for</span> <span class="n">invocation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">invocations</span><span class="p">)</span></div>



<div class="viewcode-block" id="DeclaredVariable">
<a class="viewcode-back" href="../../api/blark.transform.DeclaredVariable.html#blark.transform.DeclaredVariable">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;var1&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DeclaredVariable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single declared variable name and optional [direct or incomplete] location.</span>

<span class="sd">    Examples::</span>

<span class="sd">        iVar</span>
<span class="sd">        iVar AT %I*</span>
<span class="sd">        iVar AT %IX1.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Alternate name: VariableWithLocation? MaybeLocatedVariable?</span>
    <span class="n">variable</span><span class="p">:</span> <span class="n">SimpleVariable</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">IncompleteLocation</span><span class="p">,</span> <span class="n">Location</span><span class="p">]]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The variable name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dereferenced</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is the variable dereferenced with &#39;^&#39;?.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">dereferenced</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span></div>



<div class="viewcode-block" id="_GenericInit">
<a class="viewcode-back" href="../../api/blark.transform._GenericInit.html#blark.transform._GenericInit">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_GenericInit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API compat to give a valid init attribute.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: can we restructure this to be less confusing?</span>
    <span class="n">base_type_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">full_type_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">repr</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repr</span><span class="p">)</span></div>



<span class="n">InitDeclarationType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">TypeInitialization</span><span class="p">,</span>
    <span class="n">SubrangeTypeInitialization</span><span class="p">,</span>
    <span class="n">EnumeratedTypeInitialization</span><span class="p">,</span>
    <span class="n">ArrayTypeInitialization</span><span class="p">,</span>
    <span class="n">InitializedStructure</span><span class="p">,</span>
    <span class="n">_GenericInit</span><span class="p">,</span>  <span class="c1"># EdgeDeclaration</span>
<span class="p">]</span>


<div class="viewcode-block" id="InitDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.InitDeclaration.html#blark.transform.InitDeclaration">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">InitDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for a declaration of one or more variables with a type initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">InitDeclarationType</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variables</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="VariableOneInitDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.VariableOneInitDeclaration.html#blark.transform.VariableOneInitDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;var1_init_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VariableOneInitDeclaration</span><span class="p">(</span><span class="n">InitDeclaration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A declaration of one or more variables with a type, subrange, or enumerated</span>
<span class="sd">    type initialization.</span>

<span class="sd">    Examples::</span>

<span class="sd">        stVar1, stVar2 : (Value1, Value2)</span>
<span class="sd">        stVar1, stVar2 : (Value1 := 0, Value2 := 1)</span>
<span class="sd">        stVar1 : INT (1..2) := 25</span>
<span class="sd">        stVar1, stVar2 : TypeName := Value</span>
<span class="sd">        stVar1, stVar2 : (Value1 := 1, Value2 := 2)</span>
<span class="sd">        stVar1, stVar2 : (Value1 := 1, Value2 := 2) INT := Value1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TypeInitialization</span><span class="p">,</span> <span class="n">SubrangeTypeInitialization</span><span class="p">,</span> <span class="n">EnumeratedTypeInitialization</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span></div>



<div class="viewcode-block" id="ArrayVariableInitDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.ArrayVariableInitDeclaration.html#blark.transform.ArrayVariableInitDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;array_var_init_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ArrayVariableInitDeclaration</span><span class="p">(</span><span class="n">InitDeclaration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A declaration of one or more variables with array type initialization and</span>
<span class="sd">    optional default (initialization) value.</span>

<span class="sd">    May be indirect (e.g., POINTER TO).</span>

<span class="sd">    Examples::</span>

<span class="sd">        aVal1, aVal2 : ARRAY[*] OF TypeName</span>
<span class="sd">        aVal1 : ARRAY[1..2] OF Call(1, 2) := [1, 2]</span>
<span class="sd">        aVal1 : POINTER TO ARRAY[1..2] OF Call(1, 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">ArrayTypeInitialization</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span></div>



<div class="viewcode-block" id="StructuredVariableInitDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.StructuredVariableInitDeclaration.html#blark.transform.StructuredVariableInitDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;structured_var_init_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StructuredVariableInitDeclaration</span><span class="p">(</span><span class="n">InitDeclaration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A declaration of one or more variables using a named initialized structure.</span>

<span class="sd">    Examples::</span>

<span class="sd">        stVar1 : ST_TypeName := (iValue := 0, bValue := TRUE)</span>
<span class="sd">        stVar1, stVar2 : ST_TypeName := (iValue  = 0, bValue := TRUE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">InitializedStructure</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span></div>



<div class="viewcode-block" id="EdgeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.EdgeDeclaration.html#blark.transform.EdgeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;edge_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EdgeDeclaration</span><span class="p">(</span><span class="n">InitDeclaration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An edge declaration of one or more variables.</span>

<span class="sd">    Examples::</span>

<span class="sd">        iValue AT %IX1.1 : BOOL R_EDGE</span>
<span class="sd">        iValue : BOOL F_EDGE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]</span>
    <span class="n">edge</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">full_type_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;BOOL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edge</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">_GenericInit</span><span class="p">(</span>
            <span class="n">base_type_name</span><span class="o">=</span><span class="s2">&quot;BOOL&quot;</span><span class="p">,</span>
            <span class="n">full_type_name</span><span class="o">=</span><span class="n">full_type_name</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="nb">repr</span><span class="o">=</span><span class="n">full_type_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variables</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">full_type_name</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="FunctionBlockDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.FunctionBlockDeclaration.html#blark.transform.FunctionBlockDeclaration">[docs]</a>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionBlockDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for declarations of variables using function blocks.</span>

<span class="sd">    May either be by name (:class:`FunctionBlockNameDeclaration`) or invocation</span>
<span class="sd">    :class:`FunctionBlockInvocationDeclaration`). Marked as a &quot;tagged union&quot; so</span>
<span class="sd">    that serialization will uniquely identify the Python class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span></div>



<div class="viewcode-block" id="FunctionBlockNameDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.FunctionBlockNameDeclaration.html#blark.transform.FunctionBlockNameDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;fb_name_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionBlockNameDeclaration</span><span class="p">(</span><span class="n">FunctionBlockDeclaration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for declarations of variables using function blocks by name.</span>

<span class="sd">    Examples::</span>

<span class="sd">        fbName1 : FB_Name</span>
<span class="sd">        fbName1 : FB_Name := (iValue := 0, bValue := TRUE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>   <span class="c1"># fb_decl_name_list -&gt; fb_name</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StructureInitialization</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="n">name_and_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variables</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="n">name_and_type</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span></div>



<div class="viewcode-block" id="FunctionBlockInvocationDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.FunctionBlockInvocationDeclaration.html#blark.transform.FunctionBlockInvocationDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;fb_invocation_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionBlockInvocationDeclaration</span><span class="p">(</span><span class="n">FunctionBlockDeclaration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for declarations of variables using function blocks by invocation.</span>

<span class="sd">    Examples::</span>

<span class="sd">        fbSample : FB_Sample(nInitParam := 1) := (nInput := 2, nMyProperty := 3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">FunctionCall</span>
    <span class="n">defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StructureInitialization</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="n">name_and_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variables</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="n">name_and_type</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span></div>



<div class="viewcode-block" id="ParameterAssignment">
<a class="viewcode-back" href="../../api/blark.transform.ParameterAssignment.html#blark.transform.ParameterAssignment">[docs]</a>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ParameterAssignment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for assigned parameters in function calls.</span>

<span class="sd">    May be either input parameters (positional or named ``name :=``) or output</span>
<span class="sd">    parameters (named as in ``name =&gt;``, ``NOT name =&gt;``). Marked as a &quot;tagged</span>
<span class="sd">    union&quot; so that serialization will uniquely identify the Python class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span></div>



<div class="viewcode-block" id="InputParameterAssignment">
<a class="viewcode-back" href="../../api/blark.transform.InputParameterAssignment.html#blark.transform.InputParameterAssignment">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;param_assignment&quot;</span><span class="p">,</span> <span class="s2">&quot;input_param_assignment&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InputParameterAssignment</span><span class="p">(</span><span class="n">ParameterAssignment</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An input parameter in a function call.</span>

<span class="sd">    May be a nameless positional parameter or a named one.</span>

<span class="sd">    Examples::</span>

<span class="sd">        name := value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SimpleVariable</span><span class="p">]</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="InputParameterAssignment.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.InputParameterAssignment.html#blark.transform.InputParameterAssignment.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InputParameterAssignment</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span>
            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">InputParameterAssignment</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; := &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="OutputParameterAssignment">
<a class="viewcode-back" href="../../api/blark.transform.OutputParameterAssignment.html#blark.transform.OutputParameterAssignment">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;output_parameter_assignment&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OutputParameterAssignment</span><span class="p">(</span><span class="n">ParameterAssignment</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A named output parameter, which may be inverted.</span>

<span class="sd">    Examples::</span>

<span class="sd">        name =&gt; output</span>
<span class="sd">        NOT name =&gt; output2</span>
<span class="sd">        name =&gt;</span>
<span class="sd">        NOT name =&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">SimpleVariable</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span>
    <span class="n">inverted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="OutputParameterAssignment.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.OutputParameterAssignment.html#blark.transform.OutputParameterAssignment.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">inverted</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">SimpleVariable</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutputParameterAssignment</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">OutputParameterAssignment</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">inverted</span><span class="o">=</span><span class="n">inverted</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;NOT &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverted</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; =&gt; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<span class="n">AnyLocation</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Location</span><span class="p">,</span> <span class="n">IncompleteLocation</span><span class="p">]</span>


<div class="viewcode-block" id="GlobalVariableSpec">
<a class="viewcode-back" href="../../api/blark.transform.GlobalVariableSpec.html#blark.transform.GlobalVariableSpec">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;global_var_spec&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GlobalVariableSpec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Global variable specification; the part that comes before the</span>
<span class="sd">    initialization.</span>

<span class="sd">    Located (or incomplete located) specifications only apply to one variable,</span>
<span class="sd">    whereas simple specifications can have multiple variables.</span>

<span class="sd">    Examples::</span>

<span class="sd">        iValue1, iValue2</span>
<span class="sd">        iValue3 AT %I*</span>
<span class="sd">        iValue4 AT %IX1.1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyLocation</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="GlobalVariableSpec.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.GlobalVariableSpec.html#blark.transform.GlobalVariableSpec.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">name_or_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">],</span>
        <span class="n">location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyLocation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlobalVariableSpec</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Multiple variables without a location</span>
            <span class="n">name_tree</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span> <span class="n">name_or_names</span><span class="p">)</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="n">name_tree</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Only one variable allowed with a location</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">],</span> <span class="p">[</span><span class="n">name_or_names</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">GlobalVariableSpec</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="n">LocatedVariableSpecInit</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">TypeInitialization</span><span class="p">,</span>
    <span class="n">SubrangeTypeInitialization</span><span class="p">,</span>
    <span class="n">EnumeratedTypeInitialization</span><span class="p">,</span>
    <span class="n">ArrayTypeInitialization</span><span class="p">,</span>
    <span class="n">InitializedStructure</span><span class="p">,</span>
    <span class="n">StringTypeInitialization</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="GlobalVariableDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.GlobalVariableDeclaration.html#blark.transform.GlobalVariableDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;global_var_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GlobalVariableDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A declaration of one or more global variables: name and location</span>
<span class="sd">    specification and initialization type.</span>

<span class="sd">    Examples::</span>

<span class="sd">        fValue1 : INT;</span>
<span class="sd">        fValue2 : INT (0..10);</span>
<span class="sd">        fValue3 : (A, B);</span>
<span class="sd">        fValue4 : (A, B) DINT;</span>
<span class="sd">        fValue5 : ARRAY [1..10] OF INT;</span>
<span class="sd">        fValue6 : ARRAY [1..10] OF ARRAY [1..10] OF INT;</span>
<span class="sd">        fValue7 : FB_Test(1, 2, 3);</span>
<span class="sd">        fValue8 : FB_Test(A := 1, B := 2, C =&gt; 3);</span>
<span class="sd">        fValue9 : STRING[10] := &#39;abc&#39;;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">GlobalVariableSpec</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LocatedVariableSpecInit</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The variable names contained.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">variables</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyLocation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The (optional) variable location.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">location</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">base_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The base type name of the variable(s).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">base_type_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The full type name of the variable(s).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">full_type_name</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="Extends">
<a class="viewcode-back" href="../../api/blark.transform.Extends.html#blark.transform.Extends">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;extends&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Extends</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The &quot;EXTENDS&quot; portion of a function block, interface, structure, etc.</span>

<span class="sd">    Examples::</span>

<span class="sd">        EXTENDS stName</span>
<span class="sd">        EXTENDS FB_Name</span>
<span class="sd">        EXTENDS FB_Name, FB_Name2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">interfaces</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Extends.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Extends.html#blark.transform.Extends.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="o">*</span><span class="n">interfaces</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Extends</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Extends</span><span class="p">(</span><span class="n">interfaces</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">interfaces</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;EXTENDS &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span><span class="p">)</span></div>



<div class="viewcode-block" id="Implements">
<a class="viewcode-back" href="../../api/blark.transform.Implements.html#blark.transform.Implements">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;implements&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Implements</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The &quot;IMPLEMENTS&quot; portion of a function block, indicating it implements</span>
<span class="sd">    one or more interfaces.</span>

<span class="sd">    Examples::</span>

<span class="sd">        IMPLEMENTS I_Interface1</span>
<span class="sd">        IMPLEMENTS I_Interface1, I_Interface2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">interfaces</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Implements.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Implements.html#blark.transform.Implements.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="o">*</span><span class="n">interfaces</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Implements</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Implements</span><span class="p">(</span><span class="n">interfaces</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">interfaces</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;IMPLEMENTS &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span><span class="p">)</span></div>



<div class="viewcode-block" id="FunctionBlock">
<a class="viewcode-back" href="../../api/blark.transform.FunctionBlock.html#blark.transform.FunctionBlock">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;function_block_type_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionBlock</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full function block type declaration.</span>

<span class="sd">    A function block distinguishes itself from a regular function by having</span>
<span class="sd">    state and potentially having actions, methods, and properties. These</span>
<span class="sd">    additional parts are separate in this grammar (i.e., they do not appear</span>
<span class="sd">    within the FUNCTION_BLOCK itself).</span>

<span class="sd">    An implementation is optional, but ``END_FUNCTION_BLOCK`` is required.</span>

<span class="sd">    Examples::</span>

<span class="sd">        FUNCTION_BLOCK FB_EmptyFunctionBlock</span>
<span class="sd">        END_FUNCTION_BLOCK</span>

<span class="sd">        FUNCTION_BLOCK FB_Implementer IMPLEMENTS I_fbName</span>
<span class="sd">        END_FUNCTION_BLOCK</span>

<span class="sd">        FUNCTION_BLOCK ABSTRACT FB_Extender EXTENDS OtherFbName</span>
<span class="sd">        END_FUNCTION_BLOCK</span>

<span class="sd">        FUNCTION_BLOCK FB_WithVariables</span>
<span class="sd">        VAR_INPUT</span>
<span class="sd">            bExecute : BOOL;</span>
<span class="sd">        END_VAR</span>
<span class="sd">        VAR_OUTPUT</span>
<span class="sd">            iResult : INT;</span>
<span class="sd">        END_VAR</span>
<span class="sd">        END_FUNCTION_BLOCK</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">]</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">]</span>
    <span class="n">implements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Implements</span><span class="p">]</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableDeclarationBlock</span><span class="p">]</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FunctionBlockBody</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="FunctionBlock.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.FunctionBlock.html#blark.transform.FunctionBlock.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">fb_token</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">],</span>
        <span class="n">derived_name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">],</span>
        <span class="n">implements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Implements</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionBlock</span><span class="p">:</span>
        <span class="o">*</span><span class="n">declarations</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">FunctionBlock</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">derived_name</span><span class="p">,</span>
            <span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">implements</span><span class="o">=</span><span class="n">implements</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">declarations</span><span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">access_and_name</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;FUNCTION_BLOCK </span><span class="si">{</span><span class="n">access_and_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">implements</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
            <span class="p">(</span>
                <span class="n">header</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">declaration</span><span class="p">)</span> <span class="k">for</span> <span class="n">declaration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">],</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                <span class="s2">&quot;END_FUNCTION_BLOCK&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Function">
<a class="viewcode-back" href="../../api/blark.transform.Function.html#blark.transform.Function">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;function_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Function</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full function block type declaration, with nested variable declaration blocks.</span>

<span class="sd">    An implementation is optional, but ``END_FUNCTION`` is required.</span>

<span class="sd">    Examples::</span>

<span class="sd">        FUNCTION FuncName : INT</span>
<span class="sd">            VAR_INPUT</span>
<span class="sd">                iValue : INT := 0;</span>
<span class="sd">            END_VAR</span>
<span class="sd">            FuncName := iValue;</span>
<span class="sd">        END_FUNCTION</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">SimpleSpecification</span><span class="p">,</span> <span class="n">IndirectSimpleSpecification</span><span class="p">]]</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableDeclarationBlock</span><span class="p">]</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FunctionBody</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Function.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Function.html#blark.transform.Function.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">SimpleSpecification</span><span class="p">,</span> <span class="n">IndirectSimpleSpecification</span><span class="p">]],</span>
        <span class="o">*</span><span class="n">remainder</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Function</span><span class="p">:</span>
        <span class="o">*</span><span class="n">declarations</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">remainder</span>
        <span class="k">return</span> <span class="n">Function</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span>
            <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="n">List</span><span class="p">[</span><span class="n">VariableDeclarationBlock</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">declarations</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Optional</span><span class="p">[</span><span class="n">FunctionBody</span><span class="p">],</span> <span class="n">body</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">access_and_name</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">function</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;FUNCTION </span><span class="si">{</span><span class="n">access_and_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">return_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_type</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_type</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="p">),</span>
                <span class="o">*</span><span class="p">[</span><span class="n">indent_if</span><span class="p">(</span><span class="n">declaration</span><span class="p">)</span> <span class="k">for</span> <span class="n">declaration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">],</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                <span class="s2">&quot;END_FUNCTION&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Program">
<a class="viewcode-back" href="../../api/blark.transform.Program.html#blark.transform.Program">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;program_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Program</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full program declaration, with nested variable declaration blocks.</span>

<span class="sd">    An implementation is optional, but ``END_PROGRAM`` is required.</span>

<span class="sd">    Examples::</span>

<span class="sd">        PROGRAM ProgramName</span>
<span class="sd">            VAR_INPUT</span>
<span class="sd">                iValue : INT;</span>
<span class="sd">            END_VAR</span>
<span class="sd">            VAR_ACCESS</span>
<span class="sd">                AccessName : SymbolicVariable : TypeName READ_WRITE;</span>
<span class="sd">            END_VAR</span>
<span class="sd">            iValue := iValue + 1;</span>
<span class="sd">        END_PROGRAM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableDeclarationBlock</span><span class="p">]</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FunctionBody</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;PROGRAM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span><span class="n">indent_if</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span> <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">],</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                <span class="s2">&quot;END_PROGRAM&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<span class="n">InterfaceVariableDeclarationBlock</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="s2">&quot;InputDeclarations&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OutputDeclarations&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InputOutputDeclarations&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ExternalVariableDeclarations&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VariableDeclarations&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="Interface">
<a class="viewcode-back" href="../../api/blark.transform.Interface.html#blark.transform.Interface">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;interface_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Interface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full interface declaration, with nested variable declaration blocks.</span>

<span class="sd">    An implementation is not allowed for interfaces, but ``END_INTERFACE`` is</span>
<span class="sd">    still required.</span>

<span class="sd">    Examples::</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">]</span>
    <span class="c1"># TODO: want this to be tagged during serialization, so it&#39;s kept as</span>
    <span class="c1"># VariableDeclarationBlock.  More specifically it is</span>
    <span class="c1"># declarations: List[InterfaceVariableDeclarationBlock]</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableDeclarationBlock</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Interface.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Interface.html#blark.transform.Interface.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="c1"># access: Optional[AccessSpecifier],</span>
        <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Extends</span><span class="p">],</span>
        <span class="o">*</span><span class="n">decls</span><span class="p">:</span> <span class="n">VariableDeclarationBlock</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Interface</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Interface</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">decls</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INTERFACE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
            <span class="p">(</span>
                <span class="n">header</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">declaration</span><span class="p">)</span> <span class="k">for</span> <span class="n">declaration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">],</span>
                <span class="s2">&quot;END_INTERFACE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Action">
<a class="viewcode-back" href="../../api/blark.transform.Action.html#blark.transform.Action">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Action</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full, named action declaration.</span>

<span class="sd">    Actions belong to function blocks. Actions may not contain variable blocks,</span>
<span class="sd">    but may contain an implementation.  Variable references are assumed to be</span>
<span class="sd">    from the local namespace (i.e., the owner function block) or in the global</span>
<span class="sd">    scope.</span>

<span class="sd">    Examples::</span>

<span class="sd">        ACTION ActName</span>
<span class="sd">        END_ACTION</span>

<span class="sd">        ACTION ActName</span>
<span class="sd">            iValue := iValue + 2;</span>
<span class="sd">        END_ACTION</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FunctionBody</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ACTION </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                <span class="s2">&quot;END_ACTION&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Method">
<a class="viewcode-back" href="../../api/blark.transform.Method.html#blark.transform.Method">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;function_block_method_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Method</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A full, named method declaration.</span>

<span class="sd">    Methods belong to function blocks. Methods may contain variable blocks</span>
<span class="sd">    and a return type, and may also contain an implementation.</span>

<span class="sd">    Examples::</span>

<span class="sd">        METHOD PRIVATE MethodName : ARRAY [1..2] OF INT</span>
<span class="sd">        END_METHOD</span>

<span class="sd">        METHOD MethodName : INT</span>
<span class="sd">            MethodName := 1;</span>
<span class="sd">        END_METHOD</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LocatedVariableSpecInit</span><span class="p">]</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableDeclarationBlock</span><span class="p">]</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FunctionBody</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Method.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Method.html#blark.transform.Method.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LocatedVariableSpecInit</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Method</span><span class="p">:</span>
        <span class="o">*</span><span class="n">declarations</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">Method</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span>
            <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">declarations</span><span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">access_and_name</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="n">access_and_name</span><span class="p">,</span> <span class="s2">&quot; : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;METHOD </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span><span class="n">indent_if</span><span class="p">(</span><span class="n">declaration</span><span class="p">)</span> <span class="k">for</span> <span class="n">declaration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">],</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                <span class="s2">&quot;END_METHOD&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Property">
<a class="viewcode-back" href="../../api/blark.transform.Property.html#blark.transform.Property">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;function_block_property_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Property</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A named property declaration, which may pertain to a ``get`` or ``set``.</span>

<span class="sd">    Properties belong to function blocks. Properties may contain variable</span>
<span class="sd">    blocks and a return type, and may also contain an implementation.</span>

<span class="sd">    Examples::</span>

<span class="sd">        PROPERTY PropertyName : RETURNTYPE</span>
<span class="sd">            VAR_INPUT</span>
<span class="sd">                bExecute : BOOL;</span>
<span class="sd">            END_VAR</span>
<span class="sd">            VAR_OUTPUT</span>
<span class="sd">                iResult : INT;</span>
<span class="sd">            END_VAR</span>
<span class="sd">            iResult := 5;</span>
<span class="sd">            PropertyName := iResult + 1;</span>
<span class="sd">        END_PROPERTY</span>

<span class="sd">        PROPERTY PRIVATE PropertyName : ARRAY [1..2] OF INT</span>
<span class="sd">        END_PROPERTY</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LocatedVariableSpecInit</span><span class="p">]</span>
    <span class="n">access_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">]</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableDeclarationBlock</span><span class="p">]</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FunctionBody</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="Property.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.Property.html#blark.transform.Property.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>
        <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LocatedVariableSpecInit</span><span class="p">],</span>
        <span class="n">access_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Property</span><span class="p">:</span>
        <span class="o">*</span><span class="n">declarations</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">Property</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span>
            <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span>
            <span class="n">access_override</span><span class="o">=</span><span class="n">access_override</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">declarations</span><span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">access_and_name</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">property</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="n">access_and_name</span><span class="p">,</span> <span class="s2">&quot; : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span>
        <span class="nb">property</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_override</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;PROPERTY </span><span class="si">{</span><span class="nb">property</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span><span class="n">indent_if</span><span class="p">(</span><span class="n">declaration</span><span class="p">)</span> <span class="k">for</span> <span class="n">declaration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">],</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                <span class="s2">&quot;END_PROPERTY&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<span class="n">VariableInitDeclaration</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">ArrayVariableInitDeclaration</span><span class="p">,</span>
    <span class="n">VariableOneInitDeclaration</span><span class="p">,</span>
    <span class="n">FunctionBlockDeclaration</span><span class="p">,</span>
    <span class="n">EdgeDeclaration</span><span class="p">,</span>
    <span class="n">StructuredVariableInitDeclaration</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">InputOutputDeclaration</span> <span class="o">=</span> <span class="n">VariableInitDeclaration</span>
<span class="n">OutputDeclaration</span> <span class="o">=</span> <span class="n">VariableInitDeclaration</span>

<span class="n">InputDeclaration</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">VariableInitDeclaration</span><span class="p">,</span>
    <span class="n">EdgeDeclaration</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">GlobalVariableDeclarationType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">VariableInitDeclaration</span><span class="p">,</span>
    <span class="n">GlobalVariableDeclaration</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="VariableDeclarationBlock">
<a class="viewcode-back" href="../../api/blark.transform.VariableDeclarationBlock.html#blark.transform.VariableDeclarationBlock">[docs]</a>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VariableDeclarationBlock</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for variable declaration blocks.</span>

<span class="sd">    Marked as a &quot;tagged union&quot; so that serialization will uniquely identify the</span>
<span class="sd">    Python class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR&quot;</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">attribute_pragmas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attribute pragmas associated with the variable declaration block.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: deprecate</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;attribute_pragmas&quot;</span><span class="p">,</span> <span class="p">[])</span></div>



<div class="viewcode-block" id="VariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.VariableDeclarations.html#blark.transform.VariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;var_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variable declarations block (``VAR``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="VariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.VariableDeclarations.html#blark.transform.VariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span> <span class="n">tree</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VariableDeclarations</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">],</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">VariableDeclarations</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="StaticDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.StaticDeclarations.html#blark.transform.StaticDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;static_var_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StaticDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Static variable declarations block (``VAR_STAT``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_STAT&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="StaticDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.StaticDeclarations.html#blark.transform.StaticDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span>
        <span class="n">tree</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StaticDeclarations</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">],</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">StaticDeclarations</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR_STAT&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="TemporaryVariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.TemporaryVariableDeclarations.html#blark.transform.TemporaryVariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;temp_var_decls&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TemporaryVariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporary variable declarations block (``VAR_TEMP``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_TEMP&quot;</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="TemporaryVariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.TemporaryVariableDeclarations.html#blark.transform.TemporaryVariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TemporaryVariableDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TemporaryVariableDeclarations</span><span class="p">(</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">],</span> <span class="n">items</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;VAR_TEMP&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="MethodInstanceVariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.MethodInstanceVariableDeclarations.html#blark.transform.MethodInstanceVariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;var_inst_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MethodInstanceVariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declarations block for instance variables in methods (``VAR_INST``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_INST&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="MethodInstanceVariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.MethodInstanceVariableDeclarations.html#blark.transform.MethodInstanceVariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span> <span class="n">items</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MethodInstanceVariableDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MethodInstanceVariableDeclarations</span><span class="p">(</span>
            <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">],</span>
                <span class="n">items</span><span class="o">.</span><span class="n">children</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;VAR_INST&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="LocatedVariableDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.LocatedVariableDeclaration.html#blark.transform.LocatedVariableDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;located_var_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LocatedVariableDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declaration of a variable in a VAR block that is located.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO examples</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SimpleVariable</span><span class="p">]</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">Location</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">LocatedVariableSpecInit</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name_and_location</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_and_location</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="LocatedVariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.LocatedVariableDeclarations.html#blark.transform.LocatedVariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;located_var_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LocatedVariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Located variable declarations block (``VAR``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>

<span class="sd">    All variables in this are expected to be located (e.g., ``AT %IX1.1``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LocatedVariableDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="LocatedVariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.LocatedVariableDeclarations.html#blark.transform.LocatedVariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span>
        <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">LocatedVariableDeclaration</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LocatedVariableDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">LocatedVariableDeclarations</span><span class="p">(</span>
            <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<span class="c1">#: var_spec in the grammar</span>
<span class="n">IncompleteLocatedVariableSpecInit</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SimpleSpecification</span><span class="p">,</span>
    <span class="n">SubrangeTypeInitialization</span><span class="p">,</span>
    <span class="n">EnumeratedTypeInitialization</span><span class="p">,</span>
    <span class="n">StringTypeSpecification</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="IncompleteLocatedVariableDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.IncompleteLocatedVariableDeclaration.html#blark.transform.IncompleteLocatedVariableDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;incomplete_located_var_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IncompleteLocatedVariableDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A named, incomplete located variable declaration inside a variable block.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">SimpleVariable</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">IncompleteLocation</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">IncompleteLocatedVariableSpecInit</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name_and_location</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_and_location</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="IncompleteLocatedVariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.IncompleteLocatedVariableDeclarations.html#blark.transform.IncompleteLocatedVariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;incomplete_located_var_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IncompleteLocatedVariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Incomplete located variable declarations block (``VAR``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>

<span class="sd">    All variables in this are expected to have incomplete locations (e.g., just</span>
<span class="sd">    ``%I*``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">IncompleteLocatedVariableDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="IncompleteLocatedVariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.IncompleteLocatedVariableDeclarations.html#blark.transform.IncompleteLocatedVariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span>
        <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">IncompleteLocatedVariableDeclaration</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IncompleteLocatedVariableDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IncompleteLocatedVariableDeclarations</span><span class="p">(</span>
            <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="ExternalVariableDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.ExternalVariableDeclaration.html#blark.transform.ExternalVariableDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;external_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExternalVariableDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A named, external variable declaration inside a variable block.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">SimpleSpecification</span><span class="p">,</span>
        <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span>  <span class="c1"># SIMPLE_SPECIFICATION / STRUCTURE_TYPE_NAME / FUNCTION_BLOCK_TYPE_NAME</span>
        <span class="n">SubrangeSpecification</span><span class="p">,</span>
        <span class="n">EnumeratedSpecification</span><span class="p">,</span>
        <span class="n">ArraySpecification</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="ExternalVariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.ExternalVariableDeclarations.html#blark.transform.ExternalVariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;external_var_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExternalVariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A block of named, external variable declarations (``VAR_EXTERNAL``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_EXTERNAL&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExternalVariableDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="ExternalVariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.ExternalVariableDeclarations.html#blark.transform.ExternalVariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span>
        <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">ExternalVariableDeclaration</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExternalVariableDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ExternalVariableDeclarations</span><span class="p">(</span>
            <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR_EXTERNAL&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="InputDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.InputDeclarations.html#blark.transform.InputDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;input_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InputDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A block of named, input variable declarations (``VAR_INPUT``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_INPUT&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="InputDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.InputDeclarations.html#blark.transform.InputDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span> <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">InputDeclaration</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InputDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">InputDeclarations</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="k">if</span> <span class="n">items</span> <span class="k">else</span> <span class="p">[])</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR_INPUT&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="OutputDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.OutputDeclarations.html#blark.transform.OutputDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;output_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OutputDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A block of named, output variable declarations (``VAR_OUTPUT``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_OUTPUT&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="OutputDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.OutputDeclarations.html#blark.transform.OutputDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span> <span class="n">items</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutputDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">OutputDeclarations</span><span class="p">(</span>
            <span class="n">attrs</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">OutputDeclaration</span><span class="p">],</span> <span class="n">items</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR_OUTPUT&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="InputOutputDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.InputOutputDeclarations.html#blark.transform.InputOutputDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;input_output_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InputOutputDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A block of named, input/output variable declarations (``VAR_IN_OUT``).</span>

<span class="sd">    May be annotated with attributes (see :class:`VariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_IN_OUT&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputOutputDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="InputOutputDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.InputOutputDeclarations.html#blark.transform.InputOutputDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span> <span class="n">items</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InputOutputDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">InputOutputDeclarations</span><span class="p">(</span>
            <span class="n">attrs</span><span class="p">,</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">InputOutputDeclaration</span><span class="p">],</span> <span class="n">items</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR_IN_OUT&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="FunctionVariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.FunctionVariableDeclarations.html#blark.transform.FunctionVariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;function_var_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionVariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="FunctionVariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.FunctionVariableDeclarations.html#blark.transform.FunctionVariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VariableAttributes</span><span class="p">],</span>
        <span class="n">body</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionVariableDeclarations</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">VariableInitDeclaration</span><span class="p">],</span> <span class="n">body</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FunctionVariableDeclarations</span><span class="p">(</span>
            <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="AccessDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.AccessDeclaration.html#blark.transform.AccessDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;program_access_decl&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AccessDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single, named program access declaration.</span>

<span class="sd">    Examples::</span>

<span class="sd">        AccessName : SymbolicVariable : TypeName READ_WRITE;</span>
<span class="sd">        AccessName1 : SymbolicVariable1 : TypeName1 READ_ONLY;</span>
<span class="sd">        AccessName2 : SymbolicVariable2 : TypeName2;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">variable</span><span class="p">:</span> <span class="n">SymbolicVariable</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DataType</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">join_if</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot; &quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="AccessDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.AccessDeclarations.html#blark.transform.AccessDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;program_access_decls&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AccessDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A block of named, program access variable declarations (``VAR_ACCESS``).</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :class:`AccessDeclaration`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_ACCESS&quot;</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AccessDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="AccessDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.AccessDeclarations.html#blark.transform.AccessDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">AccessDeclaration</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AccessDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AccessDeclarations</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;VAR_ACCESS&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="GlobalVariableDeclarations">
<a class="viewcode-back" href="../../api/blark.transform.GlobalVariableDeclarations.html#blark.transform.GlobalVariableDeclarations">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;global_var_declarations&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GlobalVariableDeclarations</span><span class="p">(</span><span class="n">VariableDeclarationBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Global variable declarations block (``VAR_GLOBAL``).</span>

<span class="sd">    May be annotated with attributes (see :class:`GlobalVariableAttributes`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_header</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VAR_GLOBAL&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GlobalVariableAttributes</span><span class="p">]</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">GlobalVariableDeclaration</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="GlobalVariableDeclarations.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.GlobalVariableDeclarations.html#blark.transform.GlobalVariableDeclarations.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GlobalVariableAttributes</span><span class="p">],</span>
        <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">GlobalVariableDeclaration</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlobalVariableDeclarations</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GlobalVariableDeclarations</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># This isn&#39;t in the code; set later</span>
            <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">join_if</span><span class="p">(</span><span class="s2">&quot;VAR_GLOBAL&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
                <span class="s2">&quot;END_VAR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Statement">
<a class="viewcode-back" href="../../api/blark.transform.Statement.html#blark.transform.Statement">[docs]</a>
<span class="nd">@as_tagged_union</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Statement</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all statements in a structured text implementation section.</span>

<span class="sd">    Marked as a &quot;tagged union&quot; so that serialization will uniquely identify the</span>
<span class="sd">    Python class.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="FunctionCallStatement">
<a class="viewcode-back" href="../../api/blark.transform.FunctionCallStatement.html#blark.transform.FunctionCallStatement">[docs]</a>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;function_call_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionCallStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function (function block, method, action, etc.) call as a statement.</span>

<span class="sd">    Examples::</span>

<span class="sd">        A(1, 2);</span>
<span class="sd">        A(1, 2, sName:=&#39;test&#39;, iOutput=&gt;);</span>
<span class="sd">        A.B[1].C(1, 2);</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FunctionCallStatement.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.FunctionCallStatement.html#blark.transform.FunctionCallStatement.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">invocation</span><span class="p">:</span> <span class="n">FunctionCall</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionCallStatement</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FunctionCallStatement</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">invocation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">invocation</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">dereferenced</span><span class="o">=</span><span class="n">invocation</span><span class="o">.</span><span class="n">dereferenced</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="n">invocation</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">invoc</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">invoc</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="ChainedFunctionCallStatement">
<a class="viewcode-back" href="../../api/blark.transform.ChainedFunctionCallStatement.html#blark.transform.ChainedFunctionCallStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;chained_function_call_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChainedFunctionCallStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A chained set of function calls as a statement, in a &quot;fluent&quot; style.</span>

<span class="sd">    Examples::</span>

<span class="sd">        uut.dothis().andthenthis().andthenthat();</span>
<span class="sd">        uut.getPointerToStruct()^.dothis(A := 1).dothat(B := 2).done();</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">invocations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionCall</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="ChainedFunctionCallStatement.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.ChainedFunctionCallStatement.html#blark.transform.ChainedFunctionCallStatement.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">ChainedFunctionCall</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChainedFunctionCallStatement</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ChainedFunctionCallStatement</span><span class="p">(</span>
            <span class="n">invocations</span><span class="o">=</span><span class="n">chain</span><span class="o">.</span><span class="n">invocations</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">invoc</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">invocation</span><span class="p">)</span> <span class="k">for</span> <span class="n">invocation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">invocations</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">invoc</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="ElseIfClause">
<a class="viewcode-back" href="../../api/blark.transform.ElseIfClause.html#blark.transform.ElseIfClause">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;else_if_clause&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ElseIfClause</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The else-if ``ELSIF`` part of an ``IF/ELSIF/ELSE/END_IF`` block.&quot;&quot;&quot;</span>
    <span class="n">if_expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatementList</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ELSIF </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">if_expression</span><span class="si">}</span><span class="s2"> THEN&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="ElseClause">
<a class="viewcode-back" href="../../api/blark.transform.ElseClause.html#blark.transform.ElseClause">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;else_clause&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ElseClause</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The ``ELSE`` part of an ``IF/ELSIF/ELSE/END_IF`` block.&quot;&quot;&quot;</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatementList</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;ELSE&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="IfStatement">
<a class="viewcode-back" href="../../api/blark.transform.IfStatement.html#blark.transform.IfStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;if_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IfStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The ``IF`` part of an ``IF/ELSIF/ELSE/END_IF`` block.&quot;&quot;&quot;</span>
    <span class="n">if_expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatementList</span><span class="p">]</span>
    <span class="n">else_ifs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ElseIfClause</span><span class="p">]</span>
    <span class="n">else_clause</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElseClause</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="IfStatement.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.IfStatement.html#blark.transform.IfStatement.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">if_expr</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span>
        <span class="n">then</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatementList</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ElseIfClause</span><span class="p">,</span> <span class="n">ElseClause</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IfStatement</span><span class="p">:</span>
        <span class="n">else_clause</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElseClause</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ElseClause</span><span class="p">)</span> <span class="ow">or</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">else_clause</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">else_ifs</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">ElseIfClause</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">IfStatement</span><span class="p">(</span>
            <span class="n">if_expression</span><span class="o">=</span><span class="n">if_expr</span><span class="p">,</span>
            <span class="n">statements</span><span class="o">=</span><span class="n">then</span><span class="p">,</span>
            <span class="n">else_ifs</span><span class="o">=</span><span class="n">else_ifs</span><span class="p">,</span>
            <span class="n">else_clause</span><span class="o">=</span><span class="n">else_clause</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;IF </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">if_expression</span><span class="si">}</span><span class="s2"> THEN&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">),</span>
                <span class="o">*</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">else_if</span><span class="p">)</span> <span class="k">for</span> <span class="n">else_if</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">else_ifs</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">else_clause</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">else_clause</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;END_IF&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<span class="n">CaseMatch</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">Subrange</span><span class="p">,</span>
    <span class="n">Integer</span><span class="p">,</span>
    <span class="n">EnumeratedValue</span><span class="p">,</span>
    <span class="n">SymbolicVariable</span><span class="p">,</span>
    <span class="n">BitString</span><span class="p">,</span>
    <span class="n">Boolean</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="CaseElement">
<a class="viewcode-back" href="../../api/blark.transform.CaseElement.html#blark.transform.CaseElement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;case_element&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CaseElement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single element of a ``CASE`` statement block.</span>

<span class="sd">    May contain one or more matches with corresponding statements. Matches</span>
<span class="sd">    may include subranges, integers, enumerated values, symbolic variables,</span>
<span class="sd">    bit strings, or boolean values.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :class:`CaseMatch`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CaseMatch</span><span class="p">]</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatementList</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="CaseElement.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.CaseElement.html#blark.transform.CaseElement.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">matches</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span>
        <span class="n">statements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatementList</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseElement</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CaseElement</span><span class="p">(</span>
            <span class="n">matches</span><span class="o">=</span><span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">CaseMatch</span><span class="p">],</span> <span class="n">matches</span><span class="o">.</span><span class="n">children</span><span class="p">),</span>
            <span class="n">statements</span><span class="o">=</span><span class="n">statements</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">matches</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="CaseStatement">
<a class="viewcode-back" href="../../api/blark.transform.CaseStatement.html#blark.transform.CaseStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;case_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CaseStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A switch-like ``CASE`` statement block.</span>

<span class="sd">    May contain one or more cases with corresponding statements, and a default</span>
<span class="sd">    ``ELSE`` clause.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :class:`CaseElement`</span>
<span class="sd">    :class:`ElseClause`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">cases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CaseElement</span><span class="p">]</span>
    <span class="n">else_clause</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElseClause</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;CASE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2"> OF&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">case</span><span class="p">)</span> <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">else_clause</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">else_clause</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;END_CASE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="NoOpStatement">
<a class="viewcode-back" href="../../api/blark.transform.NoOpStatement.html#blark.transform.NoOpStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;no_op_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NoOpStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A no-operation statement referring to a variable and nothing else.</span>

<span class="sd">    Distinguished from an action depending on if the context-sensitive</span>
<span class="sd">    name matches an action or a variable name.</span>

<span class="sd">    Note that blark does not handle this for you and may arbitrarily choose</span>
<span class="sd">    one or the other.</span>

<span class="sd">    Examples::</span>

<span class="sd">        variable;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variable</span><span class="p">:</span> <span class="n">Variable</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="SetStatement">
<a class="viewcode-back" href="../../api/blark.transform.SetStatement.html#blark.transform.SetStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;set_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SetStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;set&quot; statement which conditionally sets a variable to ``TRUE``.</span>

<span class="sd">    Examples::</span>

<span class="sd">        bValue S= iValue &gt; 5;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variable</span><span class="p">:</span> <span class="n">SymbolicVariable</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> S= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="ReferenceAssignmentStatement">
<a class="viewcode-back" href="../../api/blark.transform.ReferenceAssignmentStatement.html#blark.transform.ReferenceAssignmentStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;reference_assignment_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReferenceAssignmentStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A reference assignment statement.</span>

<span class="sd">    Examples::</span>

<span class="sd">        refOne REF= refOtherOne;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variable</span><span class="p">:</span> <span class="n">SymbolicVariable</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> REF= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="ResetStatement">
<a class="viewcode-back" href="../../api/blark.transform.ResetStatement.html#blark.transform.ResetStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;reset_statement&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ResetStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;reset&quot; statement which conditionally clears a variable to ``FALSE``.</span>

<span class="sd">    Examples::</span>

<span class="sd">        bValue R= iValue &lt;= 5;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variable</span><span class="p">:</span> <span class="n">SymbolicVariable</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> R= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="ExitStatement">
<a class="viewcode-back" href="../../api/blark.transform.ExitStatement.html#blark.transform.ExitStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;exit_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExitStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A statement used to exit a loop, ``EXIT``.&quot;&quot;&quot;</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;EXIT;&quot;</span></div>



<div class="viewcode-block" id="ContinueStatement">
<a class="viewcode-back" href="../../api/blark.transform.ContinueStatement.html#blark.transform.ContinueStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;continue_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ContinueStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A statement used to jump to the top of a loop, ``CONTINUE``.&quot;&quot;&quot;</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;CONTINUE;&quot;</span></div>



<div class="viewcode-block" id="ReturnStatement">
<a class="viewcode-back" href="../../api/blark.transform.ReturnStatement.html#blark.transform.ReturnStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;return_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReturnStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A statement used to return from a function [block], ``RETURN``.</span>

<span class="sd">    No value is allowed to be returned with this statement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;RETURN;&quot;</span></div>



<div class="viewcode-block" id="AssignmentStatement">
<a class="viewcode-back" href="../../api/blark.transform.AssignmentStatement.html#blark.transform.AssignmentStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;assignment_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AssignmentStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An assignment statement.</span>

<span class="sd">    Examples::</span>

<span class="sd">        iValue := 5;</span>
<span class="sd">        iValue1 := iValue2 := 6;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Variable</span><span class="p">]</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="AssignmentStatement.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.AssignmentStatement.html#blark.transform.AssignmentStatement.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssignmentStatement</span><span class="p">:</span>
        <span class="o">*</span><span class="n">variables_and_ops</span><span class="p">,</span> <span class="n">expression</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">variables_and_ops</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">AssignmentStatement</span><span class="p">(</span>
            <span class="n">variables</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">),</span>
            <span class="n">expression</span><span class="o">=</span><span class="n">expression</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s2">&quot; := &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variables</span><span class="si">}</span><span class="s2"> := </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="WhileStatement">
<a class="viewcode-back" href="../../api/blark.transform.WhileStatement.html#blark.transform.WhileStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;while_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WhileStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A beginning conditional loop statement, ``WHILE``.&quot;&quot;&quot;</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">StatementList</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WHILE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DO&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">),</span>
                <span class="s2">&quot;END_WHILE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="RepeatStatement">
<a class="viewcode-back" href="../../api/blark.transform.RepeatStatement.html#blark.transform.RepeatStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;repeat_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RepeatStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An ending conditional loop statement, ``REPEAT``.&quot;&quot;&quot;</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">StatementList</span>
    <span class="n">expression</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;REPEAT&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;UNTIL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;END_REPEAT&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="ForStatement">
<a class="viewcode-back" href="../../api/blark.transform.ForStatement.html#blark.transform.ForStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;for_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ForStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A loop with a control variable and a start, stop, and (optional) step value.</span>

<span class="sd">    Examples::</span>

<span class="sd">        FOR iIndex := 0 TO 10</span>
<span class="sd">        DO</span>
<span class="sd">            iValue := iIndex * 2;</span>
<span class="sd">        END_FOR</span>

<span class="sd">        FOR iIndex := (iValue - 5) TO (iValue + 5) BY 2</span>
<span class="sd">        DO</span>
<span class="sd">            arrArray[iIndex] := iIndex * 2;</span>
<span class="sd">        END_FOR</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">control</span><span class="p">:</span> <span class="n">SymbolicVariable</span>
    <span class="n">from_</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">to</span><span class="p">:</span> <span class="n">Expression</span>
    <span class="n">step</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">StatementList</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; BY </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;FOR </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="si">}</span><span class="s2"> := </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_</span><span class="si">}</span><span class="s2"> TO </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to</span><span class="si">}{</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DO&quot;</span><span class="p">,</span>
                <span class="n">indent_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">),</span>
                <span class="s2">&quot;END_FOR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="LabeledStatement">
<a class="viewcode-back" href="../../api/blark.transform.LabeledStatement.html#blark.transform.LabeledStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span>
    <span class="s2">&quot;labeled_statement&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_of_statement_list_label&quot;</span><span class="p">,</span>
    <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LabeledStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A statement marked with a user-defined label.</span>

<span class="sd">    This is to support the &quot;goto&quot;-style ``JMP``.</span>

<span class="sd">    Examples::</span>

<span class="sd">        label1: A := 1;</span>

<span class="sd">        label2:</span>
<span class="sd">        IF iValue = 1 THEN</span>
<span class="sd">            A := 3;</span>
<span class="sd">        END_IF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">statement</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Statement</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2"> :&quot;</span>

        <span class="n">statement</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">statement</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Multiline statement after label - put it on the next line</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2"> :</span><span class="se">\n</span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Single line statement after label - put it on the same line</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="JumpStatement">
<a class="viewcode-back" href="../../api/blark.transform.JumpStatement.html#blark.transform.JumpStatement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;jmp_statement&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">JumpStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the &quot;goto&quot;-style ``JMP``, which points at a label.</span>

<span class="sd">    Examples::</span>

<span class="sd">        JMP label;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;JMP </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">;&quot;</span></div>



<div class="viewcode-block" id="StatementList">
<a class="viewcode-back" href="../../api/blark.transform.StatementList.html#blark.transform.StatementList">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;statement_list&quot;</span><span class="p">,</span> <span class="s2">&quot;case_element_statement_list&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StatementList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of statements, making up a structured text implementation.&quot;&quot;&quot;</span>
    <span class="n">statements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Statement</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="StatementList.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.StatementList.html#blark.transform.StatementList.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">statements</span><span class="p">:</span> <span class="n">Statement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementList</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">StatementList</span><span class="p">(</span>
            <span class="n">statements</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span> <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements</span><span class="p">)</span></div>



<span class="c1"># FunctionBlockBody = Union[</span>
<span class="c1">#     StatementList,</span>
<span class="c1"># ]</span>

<span class="n">FunctionBlockBody</span> <span class="o">=</span> <span class="n">StatementList</span>  <span class="c1"># Only supported option, for now</span>
<span class="n">FunctionBody</span> <span class="o">=</span> <span class="n">FunctionBlockBody</span>  <span class="c1"># Identical, currently</span>


<span class="n">TypeDeclarationItem</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">ArrayTypeDeclaration</span><span class="p">,</span>
    <span class="n">StructureTypeDeclaration</span><span class="p">,</span>
    <span class="n">StringTypeDeclaration</span><span class="p">,</span>
    <span class="n">SimpleTypeDeclaration</span><span class="p">,</span>
    <span class="n">SubrangeTypeDeclaration</span><span class="p">,</span>
    <span class="n">EnumeratedTypeDeclaration</span><span class="p">,</span>
    <span class="n">UnionTypeDeclaration</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="DataTypeDeclaration">
<a class="viewcode-back" href="../../api/blark.transform.DataTypeDeclaration.html#blark.transform.DataTypeDeclaration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;data_type_declaration&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DataTypeDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A data type declaration, wrapping the other declaration types with</span>
<span class="sd">    ``TYPE``/``END_TYPE``.</span>

<span class="sd">    Access specifiers may be included.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :class:`AccessSpecifier`</span>
<span class="sd">    :class:`ArrayTypeDeclaration`</span>
<span class="sd">    :class:`StructureTypeDeclaration`</span>
<span class="sd">    :class:`StringTypeDeclaration`</span>
<span class="sd">    :class:`SimpleTypeDeclaration`</span>
<span class="sd">    :class:`SubrangeTypeDeclaration`</span>
<span class="sd">    :class:`EnumeratedTypeDeclaration`</span>
<span class="sd">    :class:`UnionTypeDeclaration`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">declaration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeDeclarationItem</span><span class="p">]</span>
    <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="DataTypeDeclaration.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.DataTypeDeclaration.html#blark.transform.DataTypeDeclaration.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span>
        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessSpecifier</span><span class="p">],</span>
        <span class="n">declaration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeDeclarationItem</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataTypeDeclaration</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DataTypeDeclaration</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span> <span class="n">declaration</span><span class="o">=</span><span class="n">declaration</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaration</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;TYPE</span><span class="se">\n</span><span class="s2">END_TYPE&quot;</span>

        <span class="n">decl</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declaration</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declaration</span><span class="p">,</span> <span class="p">(</span><span class="n">StructureTypeDeclaration</span><span class="p">,</span> <span class="n">UnionTypeDeclaration</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># note: END_STRUCT; END_UNION; result in &quot;END_TYPE expected not ;&quot;</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="n">decl</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>

        <span class="n">decl</span> <span class="o">=</span> <span class="n">join_if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">decl</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;TYPE </span><span class="si">{</span><span class="n">decl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;END_TYPE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>



<span class="n">SourceCodeItem</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">DataTypeDeclaration</span><span class="p">,</span>
    <span class="n">Function</span><span class="p">,</span>
    <span class="n">FunctionBlock</span><span class="p">,</span>
    <span class="n">Action</span><span class="p">,</span>
    <span class="n">Method</span><span class="p">,</span>
    <span class="n">Program</span><span class="p">,</span>
    <span class="n">Property</span><span class="p">,</span>
    <span class="n">GlobalVariableDeclarations</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="SourceCode">
<a class="viewcode-back" href="../../api/blark.transform.SourceCode.html#blark.transform.SourceCode">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@_rule_handler</span><span class="p">(</span><span class="s2">&quot;iec_source&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SourceCode</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Top-level source code item.</span>

<span class="sd">    May contain zero or more of the following as items:</span>

<span class="sd">    * :class:`DataTypeDeclaration`</span>
<span class="sd">    * :class:`Function`</span>
<span class="sd">    * :class:`FunctionBlock`</span>
<span class="sd">    * :class:`Action`</span>
<span class="sd">    * :class:`Method`</span>
<span class="sd">    * :class:`Program`</span>
<span class="sd">    * :class:`Property`</span>
<span class="sd">    * :class:`GlobalVariableDeclarations`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SourceCodeItem</span><span class="p">]</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">raw_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">line_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_field</span><span class="p">()</span>

<div class="viewcode-block" id="SourceCode.from_lark">
<a class="viewcode-back" href="../../api/blark.transform.SourceCode.html#blark.transform.SourceCode.from_lark">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_lark</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">SourceCodeItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SourceCode</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SourceCode</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span></div>


<div class="viewcode-block" id="SourceCode.range_from_file_lines">
<a class="viewcode-back" href="../../api/blark.transform.SourceCode.html#blark.transform.SourceCode.range_from_file_lines">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">range_from_file_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_source</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">code_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># not splitlines()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">code_lines</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">end</span><span class="p">]</span>

        <span class="n">line_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">raw_line</span><span class="p">:</span> <span class="n">file_line</span> <span class="k">for</span> <span class="p">(</span><span class="n">file_line</span><span class="p">,</span> <span class="n">raw_line</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">code_lines</span><span class="p">[</span><span class="n">line_map</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">line_map</span><span class="p">[</span><span class="n">end</span><span class="p">]]</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="ExtendedSourceCode">
<a class="viewcode-back" href="../../api/blark.transform.ExtendedSourceCode.html#blark.transform.ExtendedSourceCode">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExtendedSourceCode</span><span class="p">(</span><span class="n">SourceCode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Top-level source code item - extended to include the possibility of</span>
<span class="sd">    standalone implementation details (i.e., statement lists).</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :class:`SourceCodeItem`</span>
<span class="sd">    :class:`StatementList`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">SourceCodeItem</span><span class="p">,</span> <span class="n">StatementList</span><span class="p">]]</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_annotator_wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">GrammarTransformer</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">children</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">Meta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="o">*</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">from_lark</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">wrapped</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_annotator_method_wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">GrammarTransformer</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">children</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">Meta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">from_lark</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">wrapped</span>


<div class="viewcode-block" id="GrammarTransformer">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GrammarTransformer</span><span class="p">(</span><span class="n">lark</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">Transformer_InPlaceRecursive</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grammar transformer which takes lark objects and makes a :class:`SourceCode`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    _filename : str</span>
<span class="sd">        Filename of grammar being transformed.</span>

<span class="sd">    comments : list of lark.Token</span>
<span class="sd">        Sorted list of comments and pragmas for annotating the resulting</span>
<span class="sd">        transformed grammar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>
    <span class="n">comments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]</span>

<div class="viewcode-block" id="GrammarTransformer.__init__">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">comments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">if</span> <span class="n">fn</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_code</span> <span class="o">=</span> <span class="n">source_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="n">comments</span> <span class="ow">or</span> <span class="p">[]</span></div>


    <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="o">**</span><span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">_annotator_wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">_class_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span>

<div class="viewcode-block" id="GrammarTransformer.transform">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">line_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">rebuild_lark_tree_with_line_map</span><span class="p">(</span>
                <span class="n">tree</span><span class="p">,</span>
                <span class="n">code_line_to_file_line</span><span class="o">=</span><span class="n">line_map</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">transformed</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
            <span class="n">merge_comments</span><span class="p">(</span><span class="n">transformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformed</span><span class="p">,</span> <span class="n">SourceCode</span><span class="p">):</span>
            <span class="n">transformed</span><span class="o">.</span><span class="n">raw_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_code</span>
            <span class="n">transformed</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">transformed</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">GlobalVariableDeclarations</span><span class="p">):</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">transformed</span></div>


<div class="viewcode-block" id="GrammarTransformer.constant">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.constant">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="n">Constant</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Constant</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">constant</span></div>


<div class="viewcode-block" id="GrammarTransformer.full_subrange">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.full_subrange">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_subrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FullSubrange</span><span class="p">()</span></div>


<div class="viewcode-block" id="GrammarTransformer.var1_list">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.var1_list">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">var1_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">DeclaredVariable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.struct_var1_list">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.struct_var1_list">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">struct_var1_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">DeclaredVariable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclaredVariable</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.fb_decl_name_list">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.fb_decl_name_list">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fb_decl_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.signed_integer">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.signed_integer">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">signed_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="n">from_lark</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.integer">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.integer">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="n">from_lark</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.binary_integer">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.binary_integer">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">binary_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Integer</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="n">from_lark</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.octal_integer">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.octal_integer">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">octal_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Integer</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="n">from_lark</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.hex_integer">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.hex_integer">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">hex_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Integer</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="n">from_lark</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.true">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.true">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.false">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.false">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">false</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.program_var_declarations">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.program_var_declarations">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">program_var_declarations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">declarations</span><span class="p">:</span> <span class="n">VariableDeclarationBlock</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">declarations</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrammarTransformer.case_elements">
<a class="viewcode-back" href="../../api/blark.transform.GrammarTransformer.html#blark.transform.GrammarTransformer.case_elements">[docs]</a>
    <span class="nd">@_annotator_method_wrapper</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">case_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cases</span><span class="p">:</span> <span class="n">CaseStatement</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">cases</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__default__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default function that is called if there is no attribute matching ``data``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call_userfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">new_children</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assumes tree is already transformed</span>

<span class="sd">        Re-implementation of lark.visitors.Transformer to make the code paths</span>
<span class="sd">        easier to follow.  May break based on upstream API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">new_children</span> <span class="k">if</span> <span class="n">new_children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__default__</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span></div>



<div class="viewcode-block" id="merge_comments">
<a class="viewcode-back" href="../../api/blark.transform.merge_comments.html#blark.transform.merge_comments">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_comments</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">comments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take the transformed tree and annotate comments back into meta information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">comments</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="p">(</span><span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)):</span>
        <span class="o">...</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">merge_comments</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">is_dataclass</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_comment_consumers</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;comments&quot;</span><span class="p">):</span>
                    <span class="n">meta</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">while</span> <span class="n">comments</span> <span class="ow">and</span> <span class="n">comments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">line</span> <span class="o">&lt;=</span> <span class="n">meta</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
                    <span class="n">meta</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comments</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">merge_comments</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span></div>



<div class="viewcode-block" id="transform">
<a class="viewcode-back" href="../../api/blark.transform.transform.html#blark.transform.transform">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tree</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span>
    <span class="n">comments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">line_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SourceCode</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform a ``lark.Tree`` into dataclasses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source_code : str</span>
<span class="sd">        The plain source code.</span>
<span class="sd">    tree : lark.Tree</span>
<span class="sd">        The parse tree from lark.</span>
<span class="sd">    comments : list[lark.Token], optional</span>
<span class="sd">        A list of pre-processed comments.</span>
<span class="sd">    line_map : dict[int, int], optional</span>
<span class="sd">        A map of lines from ``source_code`` to file lines.</span>
<span class="sd">    filename : pathlib.Path, optional</span>
<span class="sd">        The file associated with the source code.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SourceCode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">GrammarTransformer</span><span class="p">(</span>
        <span class="n">comments</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">comments</span> <span class="ow">or</span> <span class="p">[]),</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">transformed</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">line_map</span><span class="o">=</span><span class="n">line_map</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformed</span><span class="p">,</span> <span class="n">SourceCode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transformed</span>

    <span class="c1"># TODO: this is for custom starting points and ignores that &#39;transformed&#39;</span>
    <span class="c1"># may not be a typical &quot;SourceCodeItem&quot;. Goal is just returning a</span>
    <span class="c1"># consistent SourceCode instance</span>
    <span class="k">return</span> <span class="n">SourceCode</span><span class="p">(</span>
        <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">transformed</span><span class="p">],</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">raw_source</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
        <span class="n">line_map</span><span class="o">=</span><span class="n">line_map</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">transformed</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
    <span class="p">)</span></div>



<span class="n">Constant</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">Duration</span><span class="p">,</span>
    <span class="n">Lduration</span><span class="p">,</span>
    <span class="n">TimeOfDay</span><span class="p">,</span>
    <span class="n">Date</span><span class="p">,</span>
    <span class="n">DateTime</span><span class="p">,</span>
    <span class="n">Ldate</span><span class="p">,</span>
    <span class="n">LdateTime</span><span class="p">,</span>
    <span class="n">Real</span><span class="p">,</span>
    <span class="n">Integer</span><span class="p">,</span>
    <span class="n">String</span><span class="p">,</span>
    <span class="n">BitString</span><span class="p">,</span>
    <span class="n">Boolean</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">ArrayInitialElementType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">Expression</span><span class="p">,</span>
    <span class="n">StructureInitialization</span><span class="p">,</span>
    <span class="n">EnumeratedValue</span><span class="p">,</span>
    <span class="n">ArrayInitialization</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">if</span> <span class="n">apischema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Optional apischema deserializers</span>

    <span class="nd">@apischema</span><span class="o">.</span><span class="n">deserializer</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_method_access_deserializer</span><span class="p">(</span><span class="n">access</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AccessSpecifier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AccessSpecifier</span><span class="p">(</span><span class="n">access</span><span class="p">)</span>

    <span class="nd">@apischema</span><span class="o">.</span><span class="n">deserializer</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_var_attrs_deserializer</span><span class="p">(</span><span class="n">attrs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VariableAttributes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">VariableAttributes</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>

    <span class="nd">@apischema</span><span class="o">.</span><span class="n">deserializer</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_global_var_attrs_deserializer</span><span class="p">(</span><span class="n">attrs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlobalVariableAttributes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GlobalVariableAttributes</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Ken Lauer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>