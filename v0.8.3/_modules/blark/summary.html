

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>blark.summary &mdash; blark  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            blark
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinx.html">Sphinx API Docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/klauer/blark">GitHub Repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">blark</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">blark.summary</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for blark.summary</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">is_dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lark</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">transform</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParseResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">Identifier</span><span class="p">,</span> <span class="n">SourceType</span><span class="p">,</span> <span class="n">get_case_insensitive</span>

<span class="n">LocationType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_indented_outline</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;    &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Outline and indent the given item.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text_outline</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>


<div class="viewcode-block" id="text_outline">
<a class="viewcode-back" href="../../api/blark.summary.text_outline.html#blark.summary.text_outline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">text_outline</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a generic multiline string representation of the given object.</span>

<span class="sd">    Attempts to include field information for dataclasses, put list items</span>
<span class="sd">    on separate lines, and generally keep sensible indentation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    item : Any</span>
<span class="sd">        The item to outline.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    formatted : str or None</span>
<span class="sd">        The formatted result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">is_dataclass</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_indented_outline</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">fld</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fld</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_indented_outline</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_indented_outline</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>



<div class="viewcode-block" id="Summary">
<a class="viewcode-back" href="../../api/blark.summary.Summary.html#blark.summary.Summary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Summary</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for summary objects.&quot;&quot;&quot;</span>
    <span class="n">comments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">pragmas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>
    <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Meta</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text_outline</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="Summary.get_meta_kwargs">
<a class="viewcode-back" href="../../api/blark.summary.Summary.html#blark.summary.Summary.get_meta_kwargs">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_meta_kwargs</span><span class="p">(</span><span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Meta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">comments</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">pragmas</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">comments</span><span class="p">,</span> <span class="n">pragmas</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">get_comments_and_pragmas</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span>
            <span class="n">pragmas</span><span class="o">=</span><span class="n">pragmas</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DeclarationSummary">
<a class="viewcode-back" href="../../api/blark.summary.DeclarationSummary.html#blark.summary.DeclarationSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DeclarationSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single declaration.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">Declaration</span><span class="p">,</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">GlobalVariableDeclaration</span><span class="p">,</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">VariableInitDeclaration</span><span class="p">,</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">StructureElementDeclaration</span><span class="p">,</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">UnionElementDeclaration</span><span class="p">,</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">ExternalVariableDeclaration</span><span class="p">,</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">InitDeclaration</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">block</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">base_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2">]: declarations do not contain keys&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">qualified_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Qualified name including parent. For example, ``fbName.DeclName``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">location_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LocationType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If located, one of {&#39;input&#39;, &#39;output&#39;, &#39;memory&quot;}.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;%I&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;input&quot;</span>
        <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;%Q&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;output&quot;</span>
        <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;%M&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;memory&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="DeclarationSummary.from_declaration">
<a class="viewcode-back" href="../../api/blark.summary.DeclarationSummary.html#blark.summary.DeclarationSummary.from_declaration">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_declaration</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">InitDeclaration</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">StructureElementDeclaration</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">UnionElementDeclaration</span><span class="p">],</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">Function</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">Method</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">FunctionBlock</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">Property</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">StructureTypeDeclaration</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">block_header</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">StructureElementDeclaration</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DeclarationSummary</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;AT &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">location</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">block</span><span class="o">=</span><span class="n">block_header</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">full_type_name</span><span class="p">,</span>  <span class="c1"># TODO -&gt; get_type_summary?</span>
                    <span class="n">base_type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">base_type_name</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">UnionElementDeclaration</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DeclarationSummary</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">block</span><span class="o">=</span><span class="n">block_header</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">full_type_name</span><span class="p">,</span>
                <span class="n">base_type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">base_type_name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">item</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">FunctionBlockNameDeclaration</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">FunctionBlockInvocationDeclaration</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">DeclarationSummary</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">),</span>
                    <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">block</span><span class="o">=</span><span class="n">block_header</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">full_type_name</span><span class="p">,</span>
                    <span class="n">base_type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">base_type_name</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">InitDeclaration</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DeclarationSummary</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;AT &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">location</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">block</span><span class="o">=</span><span class="n">block_header</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">full_type_name</span><span class="p">,</span>
                    <span class="n">base_type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">base_type_name</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">ExternalVariableDeclaration</span><span class="p">):</span>
            <span class="n">location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">init</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="s2">&quot;full_type_name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
            <span class="n">base_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="s2">&quot;base_type_name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">DeclarationSummary</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                <span class="n">block</span><span class="o">=</span><span class="n">block_header</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span>
                <span class="n">base_type</span><span class="o">=</span><span class="n">base_type</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>  <span class="c1"># TODO</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TODO: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="DeclarationSummary.from_global_variable">
<a class="viewcode-back" href="../../api/blark.summary.DeclarationSummary.html#blark.summary.DeclarationSummary.from_global_variable">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_global_variable</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">GlobalVariableDeclaration</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">GlobalVariableDeclarations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">block_header</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;VAR_GLOBAL&quot;</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">location</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;AT &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DeclarationSummary</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                <span class="n">block</span><span class="o">=</span><span class="n">block_header</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">full_type_name</span><span class="p">,</span>
                <span class="n">base_type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">base_type_name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="DeclarationSummary.from_block">
<a class="viewcode-back" href="../../api/blark.summary.DeclarationSummary.html#blark.summary.DeclarationSummary.from_block">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_block</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">block</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">VariableDeclarationBlock</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Function</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Method</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">FunctionBlock</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Property</span><span class="p">],</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">from_declaration</span><span class="p">(</span>
                    <span class="n">decl</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                    <span class="n">block_header</span><span class="o">=</span><span class="n">block</span><span class="o">.</span><span class="n">block_header</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>
</div>



<div class="viewcode-block" id="ActionSummary">
<a class="viewcode-back" href="../../api/blark.summary.ActionSummary.html#blark.summary.ActionSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ActionSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single action.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Action</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">implementation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implementation_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: Actions do not contain declarations&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ActionSummary.from_statement_list">
<a class="viewcode-back" href="../../api/blark.summary.ActionSummary.html#blark.summary.ActionSummary.from_statement_list">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_statement_list</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">statements</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActionSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ActionSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
                <span class="n">body</span><span class="o">=</span><span class="n">statements</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">=</span><span class="n">statements</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">implementation</span><span class="o">=</span><span class="n">statements</span><span class="p">,</span>  <span class="c1"># TODO: this is no good</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">statements</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ActionSummary.from_action">
<a class="viewcode-back" href="../../api/blark.summary.ActionSummary.html#blark.summary.ActionSummary.from_action">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_action</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActionSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ActionSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">item</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MethodSummary">
<a class="viewcode-back" href="../../api/blark.summary.MethodSummary.html#blark.summary.MethodSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MethodSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single method.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Method</span>
    <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">implementation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implementation_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeclarationSummary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">declarations_by_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">decl</span><span class="o">.</span><span class="n">block</span><span class="p">,</span> <span class="p">{})[</span><span class="n">decl</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">decl</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="MethodSummary.from_method">
<a class="viewcode-back" href="../../api/blark.summary.MethodSummary.html#blark.summary.MethodSummary.from_method">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_method</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Method</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MethodSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">MethodSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">return_type</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">return_type</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">method</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_block</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>
</div>



<div class="viewcode-block" id="PropertyGetSetSummary">
<a class="viewcode-back" href="../../api/blark.summary.PropertyGetSetSummary.html#blark.summary.PropertyGetSetSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PropertyGetSetSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Property</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">implementation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implementation_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeclarationSummary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>



<div class="viewcode-block" id="PropertySummary">
<a class="viewcode-back" href="../../api/blark.summary.PropertySummary.html#blark.summary.PropertySummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PropertySummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single property.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">getter</span><span class="p">:</span> <span class="n">PropertyGetSetSummary</span>
    <span class="n">setter</span><span class="p">:</span> <span class="n">PropertyGetSetSummary</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1"># implementation: Optional[tf.StatementList] = None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;get&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;set&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setter</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: Properties do not contain declarations&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PropertySummary.from_property">
<a class="viewcode-back" href="../../api/blark.summary.PropertySummary.html#blark.summary.PropertySummary.from_property">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_property</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="nb">property</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Property</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PropertySummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>

        <span class="c1"># TODO: this is broken at the moment</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">PropertySummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">getter</span><span class="o">=</span><span class="n">PropertyGetSetSummary</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">item</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span>
                <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">setter</span><span class="o">=</span><span class="n">PropertyGetSetSummary</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">item</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span>
                <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="nb">property</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">decl_summary</span> <span class="o">=</span> <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_block</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">getter</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">decl_summary</span><span class="p">)</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">setter</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">decl_summary</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>
</div>



<div class="viewcode-block" id="FunctionSummary">
<a class="viewcode-back" href="../../api/blark.summary.FunctionSummary.html#blark.summary.FunctionSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single function.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Function</span>
    <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">implementation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implementation_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeclarationSummary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">declarations_by_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">decl</span><span class="o">.</span><span class="n">block</span><span class="p">,</span> <span class="p">{})[</span><span class="n">decl</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">decl</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="FunctionSummary.from_function">
<a class="viewcode-back" href="../../api/blark.summary.FunctionSummary.html#blark.summary.FunctionSummary.from_function">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_function</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Function</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">FunctionSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
            <span class="n">return_type</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">return_type</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_block</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>
</div>



<div class="viewcode-block" id="FunctionBlockSummary">
<a class="viewcode-back" href="../../api/blark.summary.FunctionBlockSummary.html#blark.summary.FunctionBlockSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionBlockSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single function block.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">FunctionBlock</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">squashed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">implementation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implementation_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActionSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MethodSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PropertySummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeclarationSummary</span><span class="p">,</span> <span class="n">MethodSummary</span><span class="p">,</span> <span class="n">PropertySummary</span><span class="p">,</span> <span class="n">ActionSummary</span><span class="p">]:</span>
        <span class="n">decl</span> <span class="o">=</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">decl</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">item</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">declarations_by_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">decl</span><span class="o">.</span><span class="n">block</span><span class="p">,</span> <span class="p">{})[</span><span class="n">decl</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">decl</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="FunctionBlockSummary.from_function_block">
<a class="viewcode-back" href="../../api/blark.summary.FunctionBlockSummary.html#blark.summary.FunctionBlockSummary.from_function_block">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_function_block</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">fb</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">FunctionBlock</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionBlockSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">FunctionBlockSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">fb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">fb</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="n">fb</span><span class="o">.</span><span class="n">extends</span><span class="o">.</span><span class="n">interfaces</span> <span class="k">if</span> <span class="n">fb</span><span class="o">.</span><span class="n">extends</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">squashed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">fb</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_block</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">fb</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>


<div class="viewcode-block" id="FunctionBlockSummary.squash_base_extends">
<a class="viewcode-back" href="../../api/blark.summary.FunctionBlockSummary.html#blark.summary.FunctionBlockSummary.squash_base_extends">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">squash_base_extends</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">function_blocks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FunctionBlockSummary</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionBlockSummary</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Squash the &quot;EXTENDS&quot; function block into this one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">extends_from</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FunctionBlockSummary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">get_case_insensitive</span><span class="p">(</span><span class="n">function_blocks</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span>
        <span class="p">]</span>
        <span class="n">extends_from</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">fb</span><span class="o">.</span><span class="n">squash_base_extends</span><span class="p">(</span><span class="n">function_blocks</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span>
            <span class="k">if</span> <span class="n">fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">extends_from</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">declarations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extends_from</span><span class="p">:</span>
            <span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">declarations</span><span class="p">)</span>
        <span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">)</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">actions</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">methods</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">properties</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span>
        <span class="k">return</span> <span class="n">FunctionBlockSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">comments</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">comments</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span>
            <span class="n">pragmas</span><span class="o">=</span><span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">pragmas</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pragmas</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">source_code</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extends_from</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_code</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="n">declarations</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span>
            <span class="n">methods</span><span class="o">=</span><span class="n">methods</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">squashed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="InterfaceSummary">
<a class="viewcode-back" href="../../api/blark.summary.InterfaceSummary.html#blark.summary.InterfaceSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InterfaceSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of an Interfae.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Interface</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">squashed</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MethodSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PropertySummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1"># TwinCAT IDE doesn&#39;t allow for actions to be added to interfaces, it</span>
    <span class="c1"># seems. Overlap with methods?</span>
    <span class="c1"># actions: List[ActionSummary] = field(default_factory=list)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeclarationSummary</span><span class="p">,</span> <span class="n">MethodSummary</span><span class="p">,</span> <span class="n">PropertySummary</span><span class="p">]:</span>
        <span class="n">decl</span> <span class="o">=</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">decl</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">item</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">declarations_by_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">decl</span><span class="o">.</span><span class="n">block</span><span class="p">,</span> <span class="p">{})[</span><span class="n">decl</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">decl</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="InterfaceSummary.from_interface">
<a class="viewcode-back" href="../../api/blark.summary.InterfaceSummary.html#blark.summary.InterfaceSummary.from_interface">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_interface</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">itf</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Interface</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InterfaceSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">itf</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">InterfaceSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">itf</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">itf</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="n">itf</span><span class="o">.</span><span class="n">extends</span><span class="o">.</span><span class="n">interfaces</span> <span class="k">if</span> <span class="n">itf</span><span class="o">.</span><span class="n">extends</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">squashed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">itf</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">itf</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_block</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">itf</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>


<div class="viewcode-block" id="InterfaceSummary.squash_base_extends">
<a class="viewcode-back" href="../../api/blark.summary.InterfaceSummary.html#blark.summary.InterfaceSummary.squash_base_extends">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">squash_base_extends</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InterfaceSummary</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InterfaceSummary</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Squash the &quot;EXTENDS&quot; INTERFACE into this one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">extends_from</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">InterfaceSummary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">get_case_insensitive</span><span class="p">(</span><span class="n">interfaces</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span>
        <span class="p">]</span>
        <span class="n">extends_from</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">fb</span><span class="o">.</span><span class="n">squash_base_extends</span><span class="p">(</span><span class="n">interfaces</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span>
            <span class="k">if</span> <span class="n">fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">extends_from</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">declarations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extends_from</span><span class="p">:</span>
            <span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">declarations</span><span class="p">)</span>
        <span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">)</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">methods</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">properties</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span>
        <span class="k">return</span> <span class="n">InterfaceSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">comments</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">comments</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span>
            <span class="n">pragmas</span><span class="o">=</span><span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">pragmas</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pragmas</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">source_code</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extends_from</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_code</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="n">declarations</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">methods</span><span class="o">=</span><span class="n">methods</span><span class="p">,</span>
            <span class="n">squashed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DataTypeSummary">
<a class="viewcode-back" href="../../api/blark.summary.DataTypeSummary.html#blark.summary.DataTypeSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DataTypeSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single data type.&quot;&quot;&quot;</span>
    <span class="c1"># Note: structures only for now.</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">TypeDeclarationItem</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">extends</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">squashed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeclarationSummary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">declarations_by_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;STRUCT&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span>
        <span class="p">}</span>

<div class="viewcode-block" id="DataTypeSummary.from_data_type">
<a class="viewcode-back" href="../../api/blark.summary.DataTypeSummary.html#blark.summary.DataTypeSummary.from_data_type">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_data_type</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">TypeDeclarationItem</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataTypeSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">StructureTypeDeclaration</span><span class="p">):</span>
            <span class="n">extends</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">extends</span><span class="o">.</span><span class="n">interfaces</span> <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">extends</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extends</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">squashed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">StructureTypeDeclaration</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">dtype</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
                <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_declaration</span><span class="p">(</span>
                        <span class="n">decl</span><span class="p">,</span>
                        <span class="n">parent</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                        <span class="n">block_header</span><span class="o">=</span><span class="s2">&quot;STRUCT&quot;</span><span class="p">,</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">UnionTypeDeclaration</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">dtype</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
                <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_declaration</span><span class="p">(</span>
                        <span class="n">decl</span><span class="p">,</span>
                        <span class="n">parent</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                        <span class="n">block_header</span><span class="o">=</span><span class="s2">&quot;UNION&quot;</span><span class="p">,</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>


<div class="viewcode-block" id="DataTypeSummary.squash_base_extends">
<a class="viewcode-back" href="../../api/blark.summary.DataTypeSummary.html#blark.summary.DataTypeSummary.squash_base_extends">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">squash_base_extends</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data_types</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DataTypeSummary</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataTypeSummary</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Squash the &quot;EXTENDS&quot; function block into this one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">extends_from</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataTypeSummary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">get_case_insensitive</span><span class="p">(</span><span class="n">data_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extends</span>
        <span class="p">]</span>
        <span class="n">extends_from</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">fb</span><span class="o">.</span><span class="n">squash_base_extends</span><span class="p">(</span><span class="n">data_types</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span>
            <span class="k">if</span> <span class="n">fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">extends_from</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">declarations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extends_from</span><span class="p">:</span>
            <span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">declarations</span><span class="p">)</span>
        <span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DataTypeSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="n">comments</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">comments</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span>
            <span class="n">pragmas</span><span class="o">=</span><span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">extends_from</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fb</span><span class="o">.</span><span class="n">pragmas</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pragmas</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">source_code</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extends_from</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_code</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
            <span class="n">extends</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extends</span><span class="p">,</span>
            <span class="n">declarations</span><span class="o">=</span><span class="n">declarations</span><span class="p">,</span>
            <span class="n">squashed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="GlobalVariableSummary">
<a class="viewcode-back" href="../../api/blark.summary.GlobalVariableSummary.html#blark.summary.GlobalVariableSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GlobalVariableSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a VAR_GLOBAL block.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">GlobalVariableDeclarations</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">qualified_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeclarationSummary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">declarations_by_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;VAR_GLOBAL&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span>
        <span class="p">}</span>

<div class="viewcode-block" id="GlobalVariableSummary.from_globals">
<a class="viewcode-back" href="../../api/blark.summary.GlobalVariableSummary.html#blark.summary.GlobalVariableSummary.from_globals">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_globals</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">decls</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">GlobalVariableDeclarations</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlobalVariableSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">decls</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">GlobalVariableSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">decls</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;(unknown)&quot;</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">decls</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">decls</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">qualified_only</span><span class="o">=</span><span class="s2">&quot;qualified_only&quot;</span> <span class="ow">in</span> <span class="n">decls</span><span class="o">.</span><span class="n">attribute_pragmas</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">decls</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">decls</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="o">**</span><span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_global_variable</span><span class="p">(</span>
                    <span class="n">decl</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span>
                    <span class="n">block_header</span><span class="o">=</span><span class="s2">&quot;VAR_GLOBAL&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>
</div>



<div class="viewcode-block" id="ProgramSummary">
<a class="viewcode-back" href="../../api/blark.summary.ProgramSummary.html#blark.summary.ProgramSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProgramSummary</span><span class="p">(</span><span class="n">Summary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a single program.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Program</span>
    <span class="n">implementation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implementation_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActionSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MethodSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PropertySummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeclarationSummary</span><span class="p">:</span>
        <span class="n">decl</span> <span class="o">=</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">decl</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">item</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">declarations_by_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DeclarationSummary</span><span class="p">]]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">decl</span><span class="o">.</span><span class="n">block</span><span class="p">,</span> <span class="p">{})[</span><span class="n">decl</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">decl</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="ProgramSummary.from_program">
<a class="viewcode-back" href="../../api/blark.summary.ProgramSummary.html#blark.summary.ProgramSummary.from_program">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_program</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">program</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Program</span><span class="p">,</span>
        <span class="n">source_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProgramSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">ProgramSummary</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">program</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">item</span><span class="o">=</span><span class="n">program</span><span class="p">,</span>
            <span class="n">source_code</span><span class="o">=</span><span class="n">source_code</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="o">**</span><span class="n">Summary</span><span class="o">.</span><span class="n">get_meta_kwargs</span><span class="p">(</span><span class="n">program</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">program</span><span class="o">.</span><span class="n">declarations</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">declarations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">DeclarationSummary</span><span class="o">.</span><span class="n">from_block</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">program</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">summary</span></div>
</div>



<div class="viewcode-block" id="path_to_file_and_line">
<a class="viewcode-back" href="../../api/blark.summary.path_to_file_and_line.html#blark.summary.path_to_file_and_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">path_to_file_and_line</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Summary</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the file/line number context for the summary items.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">part</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span></div>



<span class="n">TopLevelCodeSummaryType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">FunctionSummary</span><span class="p">,</span>
    <span class="n">FunctionBlockSummary</span><span class="p">,</span>
    <span class="n">DataTypeSummary</span><span class="p">,</span>
    <span class="n">ProgramSummary</span><span class="p">,</span>
    <span class="n">InterfaceSummary</span><span class="p">,</span>
    <span class="n">GlobalVariableSummary</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">NestedCodeSummaryType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">DeclarationSummary</span><span class="p">,</span>
    <span class="n">MethodSummary</span><span class="p">,</span>
    <span class="n">PropertySummary</span><span class="p">,</span>
    <span class="n">ActionSummary</span><span class="p">,</span>
    <span class="n">PropertyGetSetSummary</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">CodeSummaryType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">TopLevelCodeSummaryType</span><span class="p">,</span>
    <span class="n">NestedCodeSummaryType</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="CodeSummary">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CodeSummary</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summary representation of a set of code - functions, function blocks, etc.&quot;&quot;&quot;</span>
    <span class="n">functions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FunctionSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">function_blocks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FunctionBlockSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span>
    <span class="p">)</span>
    <span class="n">data_types</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DataTypeSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">programs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ProgramSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="nb">globals</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">GlobalVariableSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">interfaces</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InterfaceSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">attr_to_header</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data_types&quot;</span><span class="p">:</span> <span class="s2">&quot;Data Types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;globals&quot;</span><span class="p">:</span> <span class="s2">&quot;Global Variable Declarations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;interfaces&quot;</span><span class="p">:</span> <span class="s2">&quot;Interface Declarations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;functions&quot;</span><span class="p">:</span> <span class="s2">&quot;Functions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;function_blocks&quot;</span><span class="p">:</span> <span class="s2">&quot;Function Blocks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;programs&quot;</span><span class="p">:</span> <span class="s2">&quot;Programs&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">summary_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">attr_to_header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">name_to_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name_to_obj</span><span class="p">:</span>
                <span class="n">summary_text</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">header</span><span class="p">,</span>
                        <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">name_to_obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">obj_info</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">name</span><span class="p">,</span>
                            <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">summary_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">obj_info</span><span class="p">,</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary_text</span><span class="p">)</span>

<div class="viewcode-block" id="CodeSummary.find">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.find">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CodeSummaryType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find a declaration or other item by its qualified name.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_path</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allow_partial</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="CodeSummary.find_path">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.find_path">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">allow_partial</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CodeSummaryType</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a qualified variable name, find the path of CodeSummary objects top-down.</span>

<span class="sd">        For example, a variable declared in a function block would return a</span>
<span class="sd">        list containing the FunctionBlockSummary and then the</span>
<span class="sd">        DeclarationSummary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The qualified (&quot;dotted&quot;) variable name to find.</span>

<span class="sd">        allow_partial : bool, optional</span>
<span class="sd">            If an attribute is missing along the way, return the partial</span>
<span class="sd">            path that was found.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of CodeSummaryType or None</span>
<span class="sd">            The full path to the given object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>

        <span class="n">variable_name</span> <span class="o">=</span> <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">parts</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>  <span class="c1"># ]</span>
                <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># ]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_name</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                    <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">part_obj</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
                    <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part_obj</span><span class="p">)</span>
                    <span class="n">part_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">part_obj</span><span class="o">.</span><span class="n">base_type</span><span class="p">)</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_name</span><span class="p">(</span><span class="n">part_type</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">allow_partial</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">path</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">[</span><span class="n">variable_name</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_partial</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="CodeSummary.find_code_object_by_dotted_name">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.find_code_object_by_dotted_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_code_object_by_dotted_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CodeSummaryType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a qualified code object name, find its Summary object(s).</span>

<span class="sd">        This works to find CodeSummary objects such as::</span>

<span class="sd">            FB_Block.ActionName</span>
<span class="sd">            FB_Block.PropertyName.get</span>
<span class="sd">            FB_Block.PropertyName.set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">parts</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_name</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object by the name of </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> exists&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">remainder</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">next_obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">remainder</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">next_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> has no attribute </span><span class="si">{</span><span class="n">remainder</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">next_obj</span>

        <span class="k">return</span> <span class="n">obj</span></div>


<div class="viewcode-block" id="CodeSummary.get_all_items_by_name">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.get_all_items_by_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_items_by_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">TopLevelCodeSummaryType</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get any code item (function, data type, global variable, etc.) by name.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dct</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">globals</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">programs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_blocks</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># Very inefficient, be warned</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="n">get_case_insensitive</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">decl</span></div>


<div class="viewcode-block" id="CodeSummary.get_item_by_name">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.get_item_by_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_item_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TopLevelCodeSummaryType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single code item (function, data type, global variable, etc.) by name.</span>

<span class="sd">        Does not handle scenarios where names are shadowed by other</span>
<span class="sd">        declarations.  The first one found will take precedence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_items_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TopLevelCodeSummaryType</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> is not a top-level code object name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

<div class="viewcode-block" id="CodeSummary.append">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.append">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">CodeSummary</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In-place add code summary information from another instance.</span>

<span class="sd">        New entries take precedence over old ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_blocks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">function_blocks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">globals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">programs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">programs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">interfaces</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="p">:</span>
            <span class="c1"># LCLS_General.GVL_Logger and GVL_Logger are equally valid</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">function_blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">function_blocks</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">data_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="c1"># for name, item in other.programs.items():</span>
            <span class="c1">#     self.programs[f&quot;{namespace}.{name}&quot;] = item</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">squash</span><span class="p">()</span></div>


<div class="viewcode-block" id="CodeSummary.from_parse_results">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.from_parse_results">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_parse_results</span><span class="p">(</span>
        <span class="n">all_parsed_items</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParseResult</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">ParseResult</span><span class="p">]],</span>
        <span class="n">squash</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CodeSummary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">all_parsed_items</span><span class="p">,</span> <span class="n">ParseResult</span><span class="p">):</span>
            <span class="n">all_parsed_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_parsed_items</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">CodeSummary</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">:</span> <span class="n">ParseResult</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Meta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">meta</span><span class="o">.</span><span class="n">line</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">meta</span><span class="o">.</span><span class="n">end_line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>

            <span class="n">transformed</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">transformed</span><span class="o">.</span><span class="n">range_from_file_lines</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">end_line</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">add_implementation</span><span class="p">(</span><span class="n">parsed</span><span class="p">:</span> <span class="n">ParseResult</span><span class="p">,</span> <span class="n">impl</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">parsed</span><span class="o">.</span><span class="n">identifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">identifier</span><span class="o">.</span><span class="n">decl_impl</span> <span class="o">==</span> <span class="s2">&quot;implementation&quot;</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">find_code_object_by_dotted_name</span><span class="p">(</span><span class="n">identifier</span><span class="o">.</span><span class="n">dotted_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Implementation without previous declaration? &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="c1"># if len(matches) &gt; 1:</span>
            <span class="c1">#     raise RuntimeError(</span>
            <span class="c1">#         f&quot;Multiple matches for implementation? &quot;</span>
            <span class="c1">#         f&quot;{parsed.filename} {parsed.identifier}&quot;</span>
            <span class="c1">#     )</span>

            <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">implementation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Implementation specified twice for </span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">PropertyGetSetSummary</span><span class="p">):</span>
                <span class="o">...</span>

            <span class="k">match</span><span class="o">.</span><span class="n">implementation</span> <span class="o">=</span> <span class="n">impl</span>

            <span class="k">match</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
            <span class="k">match</span><span class="o">.</span><span class="n">implementation_source</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">source_code</span>

        <span class="n">context</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">clear_context</span><span class="p">():</span>
            <span class="n">context</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">new_context</span><span class="p">(</span><span class="n">summary</span><span class="p">:</span> <span class="n">Summary</span><span class="p">):</span>
            <span class="n">context</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">summary</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">push_context</span><span class="p">(</span><span class="n">summary</span><span class="p">:</span> <span class="n">Summary</span><span class="p">):</span>
            <span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_pou_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">ProgramSummary</span><span class="p">,</span> <span class="n">FunctionBlockSummary</span><span class="p">,</span> <span class="n">InterfaceSummary</span>
        <span class="p">]:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">ProgramSummary</span><span class="p">,</span> <span class="n">FunctionBlockSummary</span><span class="p">,</span> <span class="n">InterfaceSummary</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="n">item</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expected to parse a POU prior to this but none were in the context &quot;</span>
                <span class="s2">&quot;list.  Code summaries of PROPERTY objects, for example, require &quot;</span>
                <span class="s2">&quot;that a FUNCTION_BLOCK, INTERFACE, or PROGRAM be parsed previously.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed</span> <span class="ow">in</span> <span class="n">all_parsed_items</span><span class="p">:</span>
            <span class="n">transformed</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span> <span class="k">if</span> <span class="n">parsed</span><span class="o">.</span><span class="n">identifier</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">transformed</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">FunctionBlock</span><span class="p">):</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">FunctionBlockSummary</span><span class="o">.</span><span class="n">from_function_block</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">function_blocks</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">summary</span>
                    <span class="n">new_context</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">FunctionSummary</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">summary</span>
                    <span class="n">new_context</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">DataTypeDeclaration</span><span class="p">):</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">DataTypeSummary</span><span class="o">.</span><span class="n">from_data_type</span><span class="p">(</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">declaration</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">declaration</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">data_types</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">declaration</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span>
                    <span class="n">clear_context</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Method</span><span class="p">):</span>
                    <span class="n">pou</span> <span class="o">=</span> <span class="n">get_pou_context</span><span class="p">()</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">MethodSummary</span><span class="o">.</span><span class="n">from_method</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">pou</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                    <span class="n">push_context</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
                    <span class="n">pou</span> <span class="o">=</span> <span class="n">get_pou_context</span><span class="p">()</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">ActionSummary</span><span class="o">.</span><span class="n">from_action</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">pou</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                    <span class="n">push_context</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Property</span><span class="p">):</span>
                    <span class="n">pou</span> <span class="o">=</span> <span class="n">get_pou_context</span><span class="p">()</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">PropertySummary</span><span class="o">.</span><span class="n">from_property</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># property getters and setters are separate parse results, and must</span>
                    <span class="c1"># therefore be consolidated here</span>
                    <span class="n">existing</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">prop</span> <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">pou</span><span class="o">.</span><span class="n">properties</span> <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">summary</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                        <span class="kc">None</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">existing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">parsed</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SourceType</span><span class="o">.</span><span class="n">property_get</span><span class="p">:</span>
                            <span class="n">existing</span><span class="o">.</span><span class="n">getter</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">getter</span>
                        <span class="k">elif</span> <span class="n">parsed</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SourceType</span><span class="o">.</span><span class="n">property_set</span><span class="p">:</span>
                            <span class="n">existing</span><span class="o">.</span><span class="n">setter</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">setter</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported property summary: </span><span class="si">{</span><span class="n">parsed</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># add new property</span>
                        <span class="n">pou</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                    <span class="n">push_context</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">GlobalVariableDeclarations</span><span class="p">):</span>
                    <span class="n">clear_context</span><span class="p">()</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">GlobalVariableSummary</span><span class="o">.</span><span class="n">from_globals</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">summary</span>
                    <span class="c1"># for global_var in summary.declarations.values():</span>
                    <span class="c1">#     if not qualified_only:</span>
                    <span class="c1">#         result.globals[global_var.name] = summary</span>
                    <span class="c1">#     result.globals[global_var.qualified_name] = summary</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Program</span><span class="p">):</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">ProgramSummary</span><span class="o">.</span><span class="n">from_program</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">programs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">summary</span>
                    <span class="n">new_context</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">InterfaceSummary</span><span class="o">.</span><span class="n">from_interface</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span>
                        <span class="n">source_code</span><span class="o">=</span><span class="n">get_code_by_meta</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">meta</span><span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">summary</span>
                    <span class="n">new_context</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">StatementList</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">parsed</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">SourceType</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
                        <span class="n">add_implementation</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">identifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="c1"># Special-case: actions only have implementations</span>
                        <span class="n">parent_identifier</span> <span class="o">=</span> <span class="n">Identifier</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="n">identifier</span><span class="o">.</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">parent</span><span class="p">,</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">find_path</span><span class="p">(</span><span class="n">parent_identifier</span><span class="o">.</span><span class="n">dotted_name</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">FunctionBlockSummary</span><span class="p">,</span> <span class="n">ProgramSummary</span><span class="p">))</span>
                        <span class="n">action</span> <span class="o">=</span> <span class="n">ActionSummary</span><span class="o">.</span><span class="n">from_statement_list</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">identifier</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">statements</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                            <span class="n">source_code</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">source_code</span><span class="p">,</span>  <span class="c1"># TODO above?</span>
                            <span class="n">filename</span><span class="o">=</span><span class="n">parsed</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unhandled: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">squash</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">squash</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="CodeSummary.squash">
<a class="viewcode-back" href="../../api/blark.summary.CodeSummary.html#blark.summary.CodeSummary.squash">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">squash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Squash derived interfaces/etc to include base summaries.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_blocks</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">extends</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">squashed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">function_blocks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">squash_base_extends</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">function_blocks</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">extends</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">squashed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">squash_base_extends</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">extends</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">squashed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">squash_base_extends</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span>
                <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="LinkableItems">
<a class="viewcode-back" href="../../api/blark.summary.LinkableItems.html#blark.summary.LinkableItems">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LinkableItems</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A summary of linkable (located) declarations.&quot;&quot;&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">memory</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DeclarationSummary</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_linkable_declarations">
<a class="viewcode-back" href="../../api/blark.summary.get_linkable_declarations.html#blark.summary.get_linkable_declarations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_linkable_declarations</span><span class="p">(</span>
    <span class="n">declarations</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DeclarationSummary</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinkableItems</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all located/linkable declarations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">linkable</span> <span class="o">=</span> <span class="n">LinkableItems</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">declarations</span><span class="p">:</span>
        <span class="n">linkable_list</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">linkable</span><span class="p">,</span> <span class="n">decl</span><span class="o">.</span><span class="n">location_type</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linkable_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linkable_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">linkable</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Ken Lauer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>